<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>FAQ-常见问题列表</title>
    <url>/2021/01/25/ESP32/FAQ/</url>
    <content><![CDATA[<h2 id="FAQ-常见问题列表"><a href="#FAQ-常见问题列表" class="headerlink" title="FAQ-常见问题列表"></a>FAQ-常见问题列表</h2><p><code>以下是常见的问题列表，在配置过程中，有不明白的地方先看看下边有没有你碰到的问题，如果还是解决不了再来问店主，不要上来就问，请先按步骤操作一遍后再来问，我不是专业卖家，我要上班的，不一定能及时回复信息，请理解，谢谢！</code></p>
<blockquote>
<p><strong>问：微信扫码后，提示配网超时</strong></p>
<p>答：请确保手机连接的是2.4G WIFI，不支持5G 的WIFI 。</p>
</blockquote>
<blockquote>
<p><strong>问：在和风天气申请的key在验证时提示无效（invaild key）的key怎么办？</strong></p>
<p>答：请将输入框全部删除再粘贴即可</p>
</blockquote>
<blockquote>
<p><strong>问：在和风天气申请的key在验证时提示无权限（permission denied）怎么办？</strong></p>
<p>答：请实名认证为个人开发者即可</p>
</blockquote>
<blockquote>
<p><strong>问：在和风天气申请的key提示无权限怎么办？</strong></p>
<p>答：请实名认证为个人开发者即可</p>
</blockquote>
<blockquote>
<p><strong>问：温度显示偏高怎么办</strong></p>
<p>答：由于传感器装在壳子里，且里边芯片在工作时会发热等原因造成测的温度比实际值偏高，可以在设置里的其它页面里进行补偿</p>
</blockquote>
<blockquote>
<p><strong>问：为什么我在浏览器里无法打开<a href="http://weather.local/">http://weather.local</a> 这个参数配置界面</strong></p>
<p>答：此网址是mDNS解析，已经测试过谷歌Chrome，微软新版Edge，火狐Firefox,理论上其它基于chromium的浏览器也是没问题的</p>
</blockquote>
<blockquote>
<p><strong>问：我不想装上边的推荐的主流浏览器怎么办？</strong></p>
<p>答：那你可以查看设备最后一个关于图标，点进行，可以查看到IP地址，在浏览器里直接输入IP也可以打开参数设置界面</p>
</blockquote>
<blockquote>
<p><strong>问：为什么我打开了参数配置界面后，点击按钮都没反应呢？</strong></p>
<p>答：还是那句话，浏览器兼容性问题，请安装主流浏览器</p>
</blockquote>
<blockquote>
<p><strong>问：为什么无法收到测试邮件？</strong></p>
<p>答：邮箱设置如果你不是太清楚，可以使用里边默认的邮箱参数，只需要把下边的接收邮箱修改成你自己的即可，点击测试能收到邮件即可。需要注意的是接收邮箱前边的昵称和中间的冒号，昵称可以随便填，但是那个冒号必须是<strong>英文冒号</strong>不能是<strong>中文的冒号</strong></p>
</blockquote>
<blockquote>
<p><strong>问：为什么参数设置好后，重启就没有了？</strong></p>
<p>答：参数测试完毕，需要点击一下下边的提交按钮，然后再点击重启即可生效</p>
</blockquote>
<blockquote>
<p><strong>问：为什么我下载的更新软件(flasher-esp32-T4-x-x-x.exe)提示有病毒？</strong></p>
<p>答：这个程序是用pyinstaller 把python程序打包成Windows可执行程序exe，可能是因为调用了系统进程，被杀毒软件拦截报毒，实际是没有问题，请放心使用</p>
</blockquote>
<blockquote>
<p><strong>问：为什么我下载的更新软件（flasher-esp32-T4-x-x-x.exe）一闪而过？</strong></p>
<p>答：请安装python3运行环境，记得把添加到环境变量打上勾   <a href="https://www.python.org/ftp/python/3.9.1/python-3.9.1-embed-amd64.zip">python3.91 x64 官方下载</a></p>
</blockquote>
]]></content>
      <categories>
        <category>ESP32桌面气象站-LCD触控版</category>
      </categories>
      <tags>
        <tag>ESP32</tag>
      </tags>
  </entry>
  <entry>
    <title>固件更新记录---持续更新</title>
    <url>/2020/12/26/ESP32/update/</url>
    <content><![CDATA[
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>固件更新记录时间轴</title>
<link rel="stylesheet" href="style.css" />
<style type="text/css">
h2.top_title{border-bottom:none;background:none;text-align:center;line-height:32px; font-size:20px}
h2.top_title span{font-size:12px; color:#666;font-weight:500}
</style>
</head>
<body>
<h2 class="top_title"><a href="javascript:void(0);">4.0触屏版</a><br/></h2>
<section id="cd-timeline" class="cd-container">
	<div class="cd-timeline-block">
		<div class="cd-timeline-img cd-code">
			<img src="/2020/12/26/ESP32/update/img/cd-icon-code.svg" alt="CODE">
		</div>
		<div class="cd-timeline-content">
			<h2>V1.0.7</h2>
			<p>+ 增加了微信扫码配网,在启动时可以选择热点配网和一键配网</p>
			<p>+ 增加温湿度补偿功能，由于传感器封在壳子里及设备发热等因素，会比实际值偏高一点</p>
			<p><a href="/2020/12/26/ESP32/update/flasher-esp32-t4-1-0-7.exe">点击下载</a></p>
			<p style="color: red;">*注意:软件为x64位平台，不支持32位平台，需要python3运行环境 </p>
			<p style="color: red;">*注意:软件可能会被杀毒软件拦截，请放行 </p>
			<span class="cd-date">2021/01/23</span>
		</div>
	</div>
	<div class="cd-timeline-block">
		<div class="cd-timeline-img cd-code">
			<img src="/2020/12/26/ESP32/update/img/cd-icon-code.svg" alt="CODE">
		</div>
		<div class="cd-timeline-content">
			<h2>V1.0.6</h2>
			<p>+ 数字时钟界面增加温度及节日，界面变化在设备界面展示那一个文档展示</p>
			<p>+ 优化未来6天温度趋势图的显示</p>
			<p>+ 优化GPS对时逻辑 第一次对时成功会滴一声</p>
			<p>+ 增加PCF8563 or BM8563 RTC支持</p>
			<p>- 修改在没有网络时不再自动进入热点模式 没有网络也可以使用</p>
			<p>+ 启动界面添加倒计时功能 在启动时可以按下下载键进入热点配网模式</p>
			<p><a href="#">点击下载</a></p>
			<span class="cd-date">2021/01/14</span>
		</div>
	</div>
	<div class="cd-timeline-block">
		<div class="cd-timeline-img cd-code">
			<img src="/2020/12/26/ESP32/update/img/cd-icon-code.svg" alt="CODE">
		</div>
		<div class="cd-timeline-content">
			<h2>V1.0.5</h2>
			<p>+ 增加启动时自动检查版本更新，由于固件太大，无法OTA，请下载后通过串口更新 </p>
			<p>+ 添加烧录软件，无需进行任何设置即可更新程序，见下载连接 </p>
			<p>+ 增加GPS数据解析，实现GPS对时功能</p>
			<p>+ 增加启动时自动检查版本及更新记录</p>
			<p>+ 硬件电路增加一键自动下载功能</p>
			<p>+ 添加主界面月相名称显示</p>
			<p>+ 增加5组闹钟，共计支持6组闹钟</p>
			<p>- 修复不在闹钟界面时，闹钟不响的问题</p>
			<p>- 闹钟响时，点击一下屏幕即可关闭</p>
			<p>- 增加阴历节日及倒计时功能</p>
			<p>- 修复温度曲线显示会超出显示范围问题</p>
			<p>+ 增加背光依据设定时间自动调整功能</p>
			<p><a href="#">点击下载</a></p>
			<span class="cd-date">2021/01/03</span>
		</div>
	</div>
	<div class="cd-timeline-block">
		<div class="cd-timeline-img cd-code">
			<img src="/2020/12/26/ESP32/update/img/cd-icon-code.svg" alt="CODE">
		</div>

		<div class="cd-timeline-content">
			<h2>V1.0.4</h2>
			<p>- 修复到达一年中最后一个节日 进入含有节日倒计时的界面导致重启的问题 </p>
			<p>+ 在万年历界面的节日倒计时，添加当天的节日显示 </p>
			<p>- 修复语音不能正确报时的问题 开机会播报一下当前时段</p>
			<p>+ 在web配置界面->其它->语音报时下增加一个播报开关，并添加一个测试按钮，点击会播报当时的小时 </p>
			<p>- 修复邮件通知导致系统重启问题，邮件默认使用xfdr0805@126.com发送邮件，可以更换成你自己的邮箱，接收邮箱格式 `名称:826220967@qq.com` 前边的名称是后边对应邮箱地址的别名，里边的分号必须是英文的分号 推荐使用QQ邮箱 因为可以在微信及时收到 </p>
			<p>- 由于配置文件变化 这两个文件都要更新 </p>
			<p><a href="#">CODE点击下载</a></p>
			<p><a href="#">SPIFFS点击下载</a></p>
			<span class="cd-date">2020-12-26</span>
		</div>
	</div>
</section>


</body>
</html>]]></content>
      <categories>
        <category>ESP32桌面气象站-LCD触控版</category>
      </categories>
      <tags>
        <tag>ESP32</tag>
        <tag>firmware</tag>
      </tags>
  </entry>
  <entry>
    <title>支持的功能列表</title>
    <url>/2020/12/22/ESP32/%E5%8A%9F%E8%83%BD%E8%AF%B4%E6%98%8E/</url>
    <content><![CDATA[<h3 id="4-0触屏版-支持的功能列表"><a href="#4-0触屏版-支持的功能列表" class="headerlink" title="4.0触屏版 支持的功能列表"></a>4.0触屏版 支持的功能列表</h3><hr>
<ul>
<li>支持未来6天及实况天气预报，更新频率参数可以配置</li>
<li>支持硬件时钟，断电或没网络 超时也准确</li>
<li>支持GPS对时</li>
<li>支持实时温湿度传感器</li>
<li>支持模拟时钟，数字时钟</li>
<li>支持6组闹钟,可以设置单次与重复</li>
<li>支持cron表达式 (非常强大灵活的定时功能)</li>
<li>支持温湿度报警 可选蜂鸣器，语音，邮件通知</li>
<li>支持万年历,倒计时</li>
<li>支持节日提醒 </li>
<li>支持十二生肖 天干地支 24节气 时辰</li>
<li>支持语音报时，可自己修改语音</li>
<li>支持触摸功能</li>
<li>配网支持热点配网和扫码配网</li>
</ul>
]]></content>
      <categories>
        <category>ESP32桌面气象站-LCD触控版</category>
      </categories>
      <tags>
        <tag>ESP32</tag>
      </tags>
  </entry>
  <entry>
    <title>桌面气象站使用手册</title>
    <url>/2020/12/22/ESP32/%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4/</url>
    <content><![CDATA[<h2 id="设备上电"><a href="#设备上电" class="headerlink" title="设备上电"></a>设备上电</h2><hr>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">设备使用5V供电，使用 Micro USB 或Type C 接口的连接线</span><br></pre></td></tr></table></figure>
<h2 id="设备配网"><a href="#设备配网" class="headerlink" title="设备配网"></a>设备配网</h2><hr>
<p>设备在上电时在30秒内未连接到网络上，<del>会自动进入AP模式</del>，会显示两个按钮，一个热点配网，一个是二维码配网，可自由选择配网方式。</p>
<ul>
<li><p>热点配网</p>
<blockquote>
<p>用手机或者电脑 连接一个叫<code>ESP-Weather-Station</code>的热点，密码是<code>12345678</code> 连接上后 在浏览器地址栏里输入<code>192.168.4.1</code> 会打开一个配网页面 如下图所示 </p>
</blockquote>
<img src="/2020/12/22/ESP32/%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4/image7.png" class="" title="配网">
<img src="/2020/12/22/ESP32/%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4/image5.png" class="" title="配网"></li>
<li><p>扫码配网</p>
<blockquote>
<p>打开微信扫一扫，扫描屏幕显示的二维码，按照提示输入wifi密码进行配网，设备接收到密码后会自动重启 使用新的WiFi名称和密码连接网络</p>
</blockquote>
<img src="/2020/12/22/ESP32/%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4/image6.png" class="" title="配网"></li>
<li><p>APP配网</p>
<blockquote>
<p>安装官方ESPTOUCH 配网工具进行配网 <a href="https://www.espressif.com/zh-hans/products/software/esp-touch/resources">乐鑫官方连接</a></p>
</blockquote>
<img src="/2020/12/22/ESP32/%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4/esptouch.png" class="" title="配网">

</li>
</ul>
<p>可以点击扫描网络，选择一个网络输入密码，点击提交后，机器会重启，然后开始连接网络</p>
<h2 id="天气key申请"><a href="#天气key申请" class="headerlink" title="天气key申请"></a>天气key申请</h2><hr>
<p>到<a href="https://id.qweather.com/#/register?redirect=https%3A%2F%2Fconsole.qweather.com">和风天气官网</a>申请帐号，注册成功后，登录进后台，点击<code>和风天气开发者控制台</code>进入</p>
<img src="/2020/12/22/ESP32/%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4/image1.png" class="">

<p>在左侧找到 <code>应用管理</code> 点击右侧<code>创建应用</code> 名称随意填，选择<code>免费开发版</code> 😊 点击保存后，会得到下图所示的KEY</p>
<img src="/2020/12/22/ESP32/%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4/image2.png" class="" title="KEY">
<p>将这个KEY保存下来，后边获取设置天气参数需要用到</p>
<p>目前申请的key 根据大家反应，得需要实名谁才能正常获取天气，请大家注意</p>
<h2 id="设备参数设置"><a href="#设备参数设置" class="headerlink" title="设备参数设置"></a>设备参数设置</h2><hr>
<p>在浏览器里输入<a href="http://weather.local/">http://weather.local</a> 注意要完整输入 不是https  用户名和密码都是admin  会打开如下 所示的页面</p>
<img src="/2020/12/22/ESP32/%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4/image3.png" class="" title="主页">

<p>这里的参数根据需要进行填写即可</p>
<h3 id="闹钟使用说明"><a href="#闹钟使用说明" class="headerlink" title="闹钟使用说明"></a>闹钟使用说明</h3><hr>
<ul>
<li>闹钟支持单次和重复功能<ol>
<li>单次指支指定时间只响一次，一次响5分钟，在闹钟响时可以点击一次触摸屏停止报警</li>
<li>重复指每天到达指定时间都会响起，要关闭报警可以触摸一次屏幕关闭，如果不关闭，5分钟后自动关闭</li>
</ol>
</li>
</ul>
<h3 id="天气功能使用说明"><a href="#天气功能使用说明" class="headerlink" title="天气功能使用说明"></a>天气功能使用说明</h3><hr>
<p>将前边获取到的KEY填进APP key 里，然后可以点击验证看是否正确，如果能返回经纬度坐标，说明网络没有问题，下边的坐标名称可以修改成你想显示的内容，这个坐标名称就是显示在气象站屏幕右上角的内容，更新频率可以自由修改</p>
<h3 id="温湿度报警说明"><a href="#温湿度报警说明" class="headerlink" title="温湿度报警说明"></a>温湿度报警说明</h3><hr>
<ul>
<li>温度报警选择蜂鸣器报警，在达到指定条件时，会触发蜂鸣器间隔0.35S声音，此时点击屏幕可以关掉，如果不关，在5分钟后自动关闭</li>
<li>温度报警选择语音播报，在达到指定条件时，会触发一次语音报时，从喇叭里发出，播放完毕即结束</li>
<li>温度报警选择邮件通知时，在达到指定条件时，会自动发出一封邮件到指定邮箱，如果想在微信里收到，可以使用qq邮箱，其它的邮箱请使用客户端进行收取</li>
</ul>
<h3 id="常用邮箱参数"><a href="#常用邮箱参数" class="headerlink" title="常用邮箱参数"></a>常用邮箱参数</h3><td class="d-block comment-body markdown-body  js-comment-body">
          <p>网易系邮件配置如下：<br>
<a rel="nofollow" href="http://help.163.com/10/0731/11/6CTUBPT300753VB8.html">http://help.163.com/10/0731/11/6CTUBPT300753VB8.html</a></p>
<blockquote>
<p>163邮箱的收取邮件支持POP/IMAP两种协议，发送邮件采用SMTP协议<br>
收件和发件均使用SSL协议来进行加密传输，采用SSL协议需要单独对帐户进行设置<br>
采用SSL协议和非SSL协议时端口号有所区别，参照下表的一些常见配置组合:</p>
</blockquote>
<table>
    <thead>
        <tr>
            <th>类型</th>
            <th>服务器名称</th>
            <th>服务器地址</th>
            <th>SSL协议端口号</th>
            <th>非SSL协议端口号</th>
        </tr>
    </thead>
    <tbody>
    <tr>
        <td>收件服务器</td>
        <td>POP</td>
        <td>pop.163.com</td>
        <td>995</td>
        <td>110</td>
    </tr>
    <tr>
        <td>收件服务器</td>
        <td>IMAP</td>
        <td>imap.163.com</td>
        <td>993</td>
        <td>143</td>
    </tr>
    <tr>
        <td>发件服务器</td>
        <td>SMTP</td>
        <td>smtp.163.com</td>
        <td>465/994</td>
        <td>25</td>
    </tr>
    </tbody>
</table>
]]></content>
      <categories>
        <category>ESP32桌面气象站-LCD触控版</category>
      </categories>
      <tags>
        <tag>ESP32</tag>
      </tags>
  </entry>
  <entry>
    <title>程序更新步骤</title>
    <url>/2020/12/22/ESP32/%E6%9B%B4%E6%96%B0%E7%A8%8B%E5%BA%8F/</url>
    <content><![CDATA[<h2 id="更新步骤"><a href="#更新步骤" class="headerlink" title="更新步骤"></a>更新步骤</h2><hr>
<h3 id="更新主程序"><a href="#更新主程序" class="headerlink" title="更新主程序"></a>更新主程序</h3><ul>
<li><p>1.先从官网下载ESP Flash Down Tool <a href="https://www.espressif.com/sites/default/files/tools/flash_download_tool_v3.8.5.zip">下载地址</a></p>
</li>
<li><p>2.打开上一步下载的软件 ，选择 Developer Mode</p>
</li>
<li><p>3.选择ESP32 DownloadTool</p>
</li>
<li><p>4.加载firemware.bin 地址0x10000</p>
</li>
<li><p>5.按下图参数设置   </p>
<img src="/2020/12/22/ESP32/%E6%9B%B4%E6%96%B0%E7%A8%8B%E5%BA%8F/esp_firmware.png" class=""></li>
<li><p>6.按下图操作 <strong>非常关键的一步</strong>   </p>
<img src="/2020/12/22/ESP32/%E6%9B%B4%E6%96%B0%E7%A8%8B%E5%BA%8F/enter_down.jpg" class="">
</li>
<li><p>firmware.bin<a href="./firmware.bin" target="_blank">下载链接</a></p>
</li>
</ul>
<h3 id="更新Flash内容"><a href="#更新Flash内容" class="headerlink" title="更新Flash内容"></a>更新Flash内容</h3><hr>
<ul>
<li><p>1.先从官网下载ESP Flash Down Tool <a href="https://www.espressif.com/sites/default/files/tools/flash_download_tool_v3.8.5.zip">下载地址</a></p>
</li>
<li><p>2.打开上一步下载的软件 ，选择 Developer Mode</p>
</li>
<li><p>3.选择ESP32 DownloadTool</p>
</li>
<li><p>4.加载spiffs.bin 地址0x250000</p>
</li>
<li><p>5.按下图参数设   </p>
 <img src="/2020/12/22/ESP32/%E6%9B%B4%E6%96%B0%E7%A8%8B%E5%BA%8F/flashtool.png" class=""></li>
<li><p>6.按下图操作 <strong>非常关键的一步</strong>   </p>
 <img src="/2020/12/22/ESP32/%E6%9B%B4%E6%96%B0%E7%A8%8B%E5%BA%8F/enter_down.jpg" class="">
</li>
<li><p>spiffs.bin<a href="./spiffs.bin" target="_blank">下载链接</a></p>
</li>
</ul>
<h3 id="更新全部"><a href="#更新全部" class="headerlink" title="更新全部"></a>更新全部</h3><p><code>如果烧写地址填错，分区会被破坏，必须重新烧录分区及引导程序，可以按以下设置重新烧录即可</code></p>
<ul>
<li><p>1.加载partition.bin  地址:0x8000</p>
</li>
<li><p>2.加载BootLoader_DIO_80m_bin 地址:0x1000</p>
</li>
<li><p>3.按下图设置好   </p>
 <img src="/2020/12/22/ESP32/%E6%9B%B4%E6%96%B0%E7%A8%8B%E5%BA%8F/flash_partion.png" class="">
</li>
<li><p>bootloader_dio_80m.bin<a href="./bootloader_dio_80m.bin" target="_blank">下载链接</a></p>
</li>
<li><p>partitions.bin<a href="./partitions.bin" target="_blank">下载链接</a></p>
</li>
</ul>
]]></content>
      <categories>
        <category>ESP32桌面气象站-LCD触控版</category>
      </categories>
      <tags>
        <tag>ESP32</tag>
      </tags>
  </entry>
  <entry>
    <title>设备界面预览</title>
    <url>/2020/12/22/ESP32/%E8%AE%BE%E5%A4%87%E7%95%8C%E9%9D%A2/</url>
    <content><![CDATA[<h3 id="设备界面"><a href="#设备界面" class="headerlink" title="设备界面"></a>设备界面</h3><hr>
<p>下边是设备界面展示，具体以收到的实物为准  </p>
<img src="/2020/12/22/ESP32/%E8%AE%BE%E5%A4%87%E7%95%8C%E9%9D%A2/image7.png" class="" title="image1">
<img src="/2020/12/22/ESP32/%E8%AE%BE%E5%A4%87%E7%95%8C%E9%9D%A2/image6.png" class="" title="image1">
<img src="/2020/12/22/ESP32/%E8%AE%BE%E5%A4%87%E7%95%8C%E9%9D%A2/image1.png" class="" title="image1">
<img src="/2020/12/22/ESP32/%E8%AE%BE%E5%A4%87%E7%95%8C%E9%9D%A2/image2.png" class="" title="image1">
<img src="/2020/12/22/ESP32/%E8%AE%BE%E5%A4%87%E7%95%8C%E9%9D%A2/image5.png" class="" title="image1">
<img src="/2020/12/22/ESP32/%E8%AE%BE%E5%A4%87%E7%95%8C%E9%9D%A2/image3.png" class="" title="image1">
<img src="/2020/12/22/ESP32/%E8%AE%BE%E5%A4%87%E7%95%8C%E9%9D%A2/image4.png" class="" title="image1">

<p><code>程序随时可能会升级，界面会稍有变化，具体以实物为准</code></p>
<h3 id="语音播报素材"><a href="#语音播报素材" class="headerlink" title="语音播报素材"></a>语音播报素材</h3><hr>
<ul>
<li>甜美语音包<a href="./voice.rar" target="_blank">下载链接</a></li>
<li><del>语音更新工具</del><a href="./语音合成工具.rar" target="_blank"><del>下载链接</del></a></li>
</ul>
<p><code>以上素材来源于网络，如果大家有更好有素材，可以发送到xfdr0805@126.com 邮箱，测试OK我会更新到设备里</code></p>
<h3 id="设备外观"><a href="#设备外观" class="headerlink" title="设备外观"></a>设备外观</h3><hr>
<img src="/2020/12/22/ESP32/%E8%AE%BE%E5%A4%87%E7%95%8C%E9%9D%A2/front.jpg" class="" title="front">
<img src="/2020/12/22/ESP32/%E8%AE%BE%E5%A4%87%E7%95%8C%E9%9D%A2/back.jpg" class="" title="back">

<p><code>外壳为3D打印，材料为树脂或PLA，由于是3D打印，所以无法与使用模具做出来的产品相比较，难免会有瑕疵</code></p>
<h3 id="设备尺寸"><a href="#设备尺寸" class="headerlink" title="设备尺寸"></a>设备尺寸</h3><hr>
<ul>
<li>PCB尺寸<img src="/2020/12/22/ESP32/%E8%AE%BE%E5%A4%87%E7%95%8C%E9%9D%A2/pcb_skill.png" class="" title="pcb_skill">
<img src="/2020/12/22/ESP32/%E8%AE%BE%E5%A4%87%E7%95%8C%E9%9D%A2/pcb_3d.png" class="" title="pcb_3d"></li>
<li>外壳尺寸<img src="/2020/12/22/ESP32/%E8%AE%BE%E5%A4%87%E7%95%8C%E9%9D%A2/box_size.png" class="" title="box_size">
<img src="/2020/12/22/ESP32/%E8%AE%BE%E5%A4%87%E7%95%8C%E9%9D%A2/box.png" class="" title="box"></li>
<li>3D打印文件<a href="./3D打印文件.rar" target="_blank">下载链接</a></li>
</ul>
]]></content>
      <categories>
        <category>ESP32桌面气象站-LCD触控版</category>
      </categories>
      <tags>
        <tag>ESP32</tag>
      </tags>
  </entry>
  <entry>
    <title>墨水屏气象站</title>
    <url>/2021/01/26/ESP32-Epaper/index/</url>
    <content><![CDATA[<h3 id="ESP32桌面气象站-墨水屏版-正在开发中"><a href="#ESP32桌面气象站-墨水屏版-正在开发中" class="headerlink" title="ESP32桌面气象站-墨水屏版  正在开发中"></a>ESP32桌面气象站-墨水屏版  正在开发中</h3>]]></content>
      <categories>
        <category>ESP32桌面气象站-墨水屏版</category>
      </categories>
      <tags>
        <tag>ESP32</tag>
        <tag>epaper</tag>
      </tags>
  </entry>
  <entry>
    <title>Sonoff-1CH</title>
    <url>/2020/12/29/HomeKit/sonoff-1ch/</url>
    <content><![CDATA[<hr>
<h3 id="待续…"><a href="#待续…" class="headerlink" title="待续…"></a>待续…</h3>]]></content>
      <categories>
        <category>homekit</category>
      </categories>
      <tags>
        <tag>sonoff</tag>
        <tag>1ch</tag>
      </tags>
  </entry>
  <entry>
    <title>Sonoff-2CH</title>
    <url>/2020/12/28/HomeKit/sonoff-2ch/</url>
    <content><![CDATA[<hr>
<h3 id="待续…"><a href="#待续…" class="headerlink" title="待续…"></a>待续…</h3>]]></content>
      <categories>
        <category>homekit</category>
      </categories>
      <tags>
        <tag>sonoff</tag>
        <tag>2ch</tag>
      </tags>
  </entry>
  <entry>
    <title>Sonoff-4CH</title>
    <url>/2020/12/26/HomeKit/sonoff-4ch/</url>
    <content><![CDATA[<hr>
<h3 id="待续…"><a href="#待续…" class="headerlink" title="待续…"></a>待续…</h3>]]></content>
      <categories>
        <category>homekit</category>
      </categories>
      <tags>
        <tag>sonoff</tag>
        <tag>4ch</tag>
      </tags>
  </entry>
  <entry>
    <title>v3s上使用sox产生测试信号</title>
    <url>/2021/08/05/Linux/v3s%E4%B8%8A%E4%BD%BF%E7%94%A8sox%E4%BA%A7%E7%94%9F%E6%B5%8B%E8%AF%95%E4%BF%A1%E5%8F%B7/</url>
    <content><![CDATA[<h2 id="交叉编译音频界的瑞士军刀SOX并播放音乐并产生各种测试音频信号"><a href="#交叉编译音频界的瑞士军刀SOX并播放音乐并产生各种测试音频信号" class="headerlink" title="交叉编译音频界的瑞士军刀SOX并播放音乐并产生各种测试音频信号"></a>交叉编译音频界的瑞士军刀SOX并播放音乐并产生各种测试音频信号</h2><ol>
<li><p>从此处下载<a href="http://sox.sourceforge.net/">sox官网</a> 解压后新建一个autoconfig.sh脚本<br> <code>这里使用了绝对路径，使用相对路径在最后链接时找不到文件，所以直接使用了绝对路径,里边的一些插件如果不需要可以去掉，我也一起打包传上来，另外这手动编译依赖可真烦那，只能缺哪个下载哪个再编译哪个最后才能给链接出来，跟buildroot里3S钟把sox勾选上完事编译完事相比，手动编译估计得3小时 ^*_*^，简直弱爆了</code><br> #!/bin/sh<br> ./configure <br> CC=”arm-linux-gnueabihf-gcc” <br> LDFLAGS=”-L/home/xfdr/v3s_licheepi_zero/sox-14.4.2-sonavox/alsa/ -L/home/xfdr/v3s_licheepi_zero/sox-14.4.2-sonavox/flac-1.3.3/src/libFLAC/.libs -L/home/xfdr/v3s_licheepi_zero/sox-14.4.2-sonavox/lame-3.100/libmp3lame/.libs/ -L/home/xfdr/v3s_licheepi_zero/sox-14.4.2-sonavox/twolame-0.4.0/libtwolame/.libs/ -L/home/xfdr/v3s_licheepi_zero/sox-14.4.2-sonavox/libmad-0.15.1b/.libs/ -L/home/xfdr/v3s_licheepi_zero/sox-14.4.2-sonavox/libid3tag-0.15.1b/.libs/ -L/home/xfdr/v3s_licheepi_zero/sox-14.4.2-sonavox/zlib-1.2.11” <br> CFLAGS=”-I/home/xfdr/v3s_licheepi_zero/buildroot-2021.02/output/host/arm-buildroot-linux-gnueabihf/sysroot/usr/include/ -I/home/xfdr/v3s_licheepi_zero/sox-14.4.2-sonavox/lame-3.100/include/ -I/home/xfdr/v3s_licheepi_zero/sox-14.4.2-sonavox/flac-1.3.3/src/libFLAC/ -I/home/xfdr/v3s_licheepi_zero/sox-14.4.2-sonavox/twolame-0.4.0/libtwolame/ -I/home/xfdr/v3s_licheepi_zero/sox-14.4.2-sonavox/libmad-0.15.1b/ -I/home/xfdr/v3s_licheepi_zero/sox-14.4.2-sonavox/libid3tag-0.15.1b/“ <br> –prefix /opt/sox.14.4.2 <br> –host=arm-linux-gnueabihf <br> –target=arm-linux <br> –with-alsa <br> –with-flac <br> –with-mp3 <br> –with-id3tag <br> –with-lame <br> –with-wavpack <br> #–with-twolame \</p>
</li>
<li><p>编译完成后执行make install 即可，安装目录就是上边指定的,拷贝到开发板或者NFS目录下</p>
</li>
<li><p>先来播放音乐试一下<br> <code># ./sox.14.4.2/bin/play -t mp3 ./群星-雨花石.mp3</code><br> ./sox.14.4.2/bin/play WARN alsa: can’t encode 0-bit Unknown or not applicable</p>
<p> ./群星-雨花石.mp3:</p>
<p> File Size: 13.7M     Bit Rate: 321k<br> Encoding: MPEG audio    Info: 163 key(Don’t modify):cEgtqHxwpdRKcBCRPBlPkg2DgcBlNoDaE7DLI/2UHqynoBve87Svw+quIkOr72Ov7q2menCG1hUs953Iws8wjHxQUjhQGB3sa2Sa9AVOc0ek4+GcHOxN9VcDh3GNItlfDRG7Pi/y+oz0U3xrKMvDiHZErPJlv6SHCl/k5qddt6BXsgTw3fn/9fNu/LLy/lawUWghlFz+aUkza7omDosFsjHYbZYrBjDqcCegSdhUOA43QD89da8FaXkqPqcMQVYqEBm7uirR2NrhGOOGt29H8sgWqCZ1icsjX7XcnX0035IQQ5Fj3dVW49U4iJMDLJtbM9DDheK/KwCziC1y9ISodum8kf9PC7+b+JLNr/mhg5DifEjdqngnEHAzqRUNufhtjc530m+aglaPBRphTfryHMYPKTWq311dQFnn9Ru1rnrpjBwyc9avaOrd10VsncqCPRHdRET/f7ygAMyztzSPzQ==<br> Channels: 2 @ 16-bit   Track: 4<br> Samplerate: 44100Hz      Album: 女人如歌  柔情魅声<br> Replaygain: off         Artist: 群星<br> Duration: 00:05:40.79  Title: 雨花石</p>
<p> In:1.23% 00:00:04.18 [00:05:36.61] Out:184k  [     =|==    ]        Clip:0<br> Aborted.<br> <code># ./sox.14.4.2/bin/play -t flac ./wodeloulan.flac</code><br> ./sox.14.4.2/bin/play WARN alsa: can’t encode 0-bit Unknown or not applicable</p>
<p> ./wodeloulan.flac:</p>
<p> File Size: 39.0M     Bit Rate: 952k<br> Encoding: FLAC<br> Channels: 2 @ 16-bit<br> Samplerate: 44100Hz      Album: 倔强<br> Replaygain: off         Artist: 云朵<br> Duration: 00:05:27.59  Title: 我的楼兰</p>
<p> In:0.48% 00:00:01.58 [00:05:26.01] Out:69.6k [   ===|==-   ]        Clip:0<br> Aborted.</p>
</li>
<li><p>音乐播放没问题,也可以播放网络音频<br> <code># ./play -t flac http://192.168.6.123:8080/wodeloulan.flac</code><br> ./play WARN alsa: can’t encode 0-bit Unknown or not applicable</p>
<p> <a href="http://192.168.6.123:8080/wodeloulan.flac">http://192.168.6.123:8080/wodeloulan.flac</a>:</p>
<p> File Size: 0         Bit Rate: 0<br> Encoding: FLAC<br> Channels: 2 @ 16-bit<br> Samplerate: 44100Hz      Album: 倔强<br> Replaygain: off         Artist: 云朵<br> Duration: 00:05:27.59  Title: 我的楼兰</p>
<p> In:0.57% 00:00:01.86 [00:05:25.73] Out:81.9k [    ==|==-   ]        Clip:0<br> Aborted.</p>
</li>
<li><p>下边开始使用sox产生一些测试信号试试<br> 产生1Khz 44.1KHz 0dB 的sin pink white<br> play -V -r 48000 -b 16 -c 2 -n synth sin 1000 vol 0db<br> play -V -r 48000 -b 16 -c 2 -n synth pink 1000 vol 0db<br> play -V -r 48000 -b 16 -c 2 -n synth white 1000 vol 0db</p>
<p> <code>#  ./play -V -r 48000 -b 16 -c 2 -n synth pink 1000 vol 0db</code><br> ./play WARN alsa: can’t encode 0-bit Unknown or not applicable<br> ./play:      SoX v14.4.2</p>
<p> Input File     : ‘’ (null)<br> Channels       : 2<br> Sample Rate    : 48000<br> Precision      : 16-bit<br> Endian Type    : little<br> Reverse Nibbles: no<br> Reverse Bits   : no</p>
<p> <code>./play INFO formats: can&#39;t set sample rate 48000; using 44100</code></p>
<p> Output File    : ‘default’ (alsa)<br> Channels       : 2<br> Sample Rate    : 44100<br> Precision      : 16-bit<br> Sample Encoding: 16-bit Signed Integer PCM<br> Endian Type    : little<br> Reverse Nibbles: no<br> Reverse Bits   : no</p>
<p> ./play INFO vol: has no effect in this configuration<br> ./play INFO sox: effects chain: input        48000Hz  2 channels<br> ./play INFO sox: effects chain: synth        48000Hz  2 channels<br> ./play INFO sox: effects chain: rate         44100Hz  2 channels<br> ./play INFO sox: effects chain: dither       44100Hz  2 channels<br> ./play INFO sox: effects chain: output       44100Hz  2 channels<br> In:0.00% 00:00:04.78 [00:00:00.00] Out:203k  [      |      ] Hd:3.4 Clip:0<br> Aborted.</p>
</li>
<li><p>从 20Hz 到 20kHz 的频率扫描，持续时间为 30 秒  音量0 重复10次<br> play -V -r 44100 -b -c 2 -n synth 30 sin 20+20000 vol 0db repeat 10</p>
</li>
<li><p>20-10kHz 和 1kHz-20kHz 双频扫描<br> play -V -r 44100 -n synth 30 sin 20+10000 sin 1000+20000 remix 1,2 channels 2</p>
</li>
<li><p>获取音频文件的各种信息</p>
<pre><code> # ./sox.14.4.2/bin/soxi 群星-雨花石.mp3 

 Input File     : &#39;群星-雨花石.mp3&#39;
 Channels       : 2
 Sample Rate    : 44100
 Precision      : 16-bit
 Duration       : 00:05:40.79 = 15028992 samples = 25559.5 CDDA sectors
 File Size      : 13.7M
 Bit Rate       : 321k
 Sample Encoding: MPEG audio (layer I, II or III)
 Comments       : 
 Title=雨花石
 Artist=群星
 Album=女人如歌  柔情魅声
 Tracknumber=4
 Comment=163 key(Don&#39;t modify):cEgtqHxwpdRKcBCRPBlPkg2DgcBlNoDaE7DLI/2UHqynoBve87Svw+quIkOr72Ov7q2menCG1hUs953Iws8wjHxQUjhQGB3sa2Sa9AVOc0ek4+GcHOxN9VcDh3GNItlfDRG7Pi/y+oz0U3xrKMvDiHZErPJlv6SHCl/k5qddt6BXsgTw3fn/9fNu/LLy/lawUWghlFz+aUkza7omDosFsjHYbZYrBjDqcCegSdhUOA43QD89da8FaXkqPqcMQVYqEBm7uirR2NrhGOOGt29H8sgWqCZ1icsjX7XcnX0035IQQ5Fj3dVW49U4iJMDLJtbM9DDheK/KwCziC1y9ISodum8kf9PC7+b+JLNr/mhg5DifEjdqngnEHAzqRUNufhtjc530m+aglaPBRphTfryHMYPKTWq311dQFnn9Ru1rnrpjBwyc9avaOrd10VsncqCPRHdRET/f7ygAMyztzSPzQ==
 Discnumber=1
 # ./sox.14.4.2/bin/soxi   abc.flac 

 Input File     : &#39;abc.flac&#39;
 Channels       : 2
 Sample Rate    : 44100
 Precision      : 16-bit
 Duration       : 00:04:14.76 = 11234921 samples = 19107 CDDA sectors
 File Size      : 28.9M
 Bit Rate       : 908k
 Sample Encoding: 16-bit FLAC
 Comments       : 
 ALBUM ARTIST=彭佳慧
 ARTIST=彭佳慧
 TITLE=相见恨晚</code></pre>
</li>
</ol>
<pre><code>    获取总时间
    # ./sox.14.4.2/bin/soxi  -d abc.flac 
    00:04:14.76
    # ./sox.14.4.2/bin/soxi  -D abc.flac 
    254.760113</code></pre>
<ol start="9">
<li><p>从任意位置播放歌曲</p>
<pre><code> # ./sox.14.4.2/bin/play abc.flac  trim 53 =240
 ./sox.14.4.2/bin/play WARN alsa: can&#39;t encode 0-bit Unknown or not applicable

 abc.flac:

 File Size: 28.9M     Bit Rate: 908k
 Encoding: FLAC          
 Channels: 2 @ 16-bit   
 Samplerate: 44100Hz      
 Replaygain: off         Artist: 彭佳慧
 Duration: 00:04:14.76  Title: 相见恨晚

 In:25.0% 00:01:03.59 [00:03:11.17] Out:467k  [-=====|=====-] Hd:0.2 Clip:0    
 Aborted.
 # ./sox.14.4.2/bin/play abc.flac  trim 100 =240
 ./sox.14.4.2/bin/play WARN alsa: can&#39;t encode 0-bit Unknown or not applicable

 abc.flac:

 File Size: 28.9M     Bit Rate: 908k
 Encoding: FLAC          
 Channels: 2 @ 16-bit   
 Samplerate: 44100Hz      
 Replaygain: off         Artist: 彭佳慧
 Duration: 00:04:14.76  Title: 相见恨晚

 In:40.2% 00:01:42.51 [00:02:32.25] Out:111k  [======|======] Hd:0.2 Clip:0    
 Aborted.</code></pre>
</li>
<li><p>从这条命令里还可以一直获取到当前播放进度，到这里你应该已经想到了，这不就可以做一个音乐播放器了嘛，需要的条件都已经满足了</p>
</li>
</ol>
<h3 id="sox功能还有很多，不过这几个功能目前已经满足我的需要了，其它高级玩法就留给大家了"><a href="#sox功能还有很多，不过这几个功能目前已经满足我的需要了，其它高级玩法就留给大家了" class="headerlink" title="sox功能还有很多，不过这几个功能目前已经满足我的需要了，其它高级玩法就留给大家了"></a>sox功能还有很多，不过这几个功能目前已经满足我的需要了，其它高级玩法就留给大家了</h3>]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>V3S</tag>
        <tag>BT</tag>
        <tag>Audio</tag>
        <tag>sox</tag>
      </tags>
  </entry>
  <entry>
    <title>web配置界面在线体验</title>
    <url>/2020/12/26/ESP32/webpage/</url>
    <content><![CDATA[
<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport"
        content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no">
    <link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <link
        href="https://s0.pstatp.com/cdn/expire-1-M/bootstrap-datetimepicker/4.17.47/css/bootstrap-datetimepicker.min.css"
        rel="stylesheet">
    <link href="https://s3.pstatp.com/cdn/expire-1-M/bootstrap-switch/3.3.4/css/bootstrap3/bootstrap-switch.min.css"
        rel="stylesheet">
    <link href="https://s1.pstatp.com/cdn/expire-1-M/bootstrap-slider/10.6.1/css/bootstrap-slider.min.css"
        rel="stylesheet">
    <link href="https://s1.pstatp.com/cdn/expire-1-M/pretty-checkbox/3.0.3/pretty-checkbox.min.css" rel="stylesheet">
    <title>WIFI桌面气象站</title>
    <style>
        .footer {
            position: fixed;
            bottom: 0;
            width: 100%;
            height: 60px;
            /* Set the fixed height of the footer here */
            line-height: 60px;
            /* Vertically center the text there */
            background-color: #f5f5f5;
        }

        #brightness-slider .slider-selection {
            background: rgb(0, 155, 245);
        }

        label {
            margin-top: 8px;
        }

        strong {
            font-size: 1.3em;
            color: cornflowerblue;
        }
    </style>
</head>

<body>

    <h3 style="text-align:center;color: dodgerblue">WIFI桌面气象站</h3>
    <div class="container" style="width:600px;">
        <div id="he-plugin-standard"></div>
        <br>
        <ul id="myTab" class="nav nav-tabs">
            <li class="active"><a href="#_home" data-toggle="tab">网络设置</a></li>
            <li><a href="#_alarm" data-toggle="tab">闹钟设置</a></li>
            <li><a href="#_weather" tabindex="-1" data-toggle="tab">天气配置</a></li>
            <li><a href="#_tips" tabindex="-1" data-toggle="tab">备忘录</a></li>
            <li><a href="#_temp" tabindex="-1" data-toggle="tab">温湿度</a></li>
            <li><a href="#_other" tabindex="-1" data-toggle="tab">其它</a></li>
            <li><a href="#_about" tabindex="-1" data-toggle="tab">关于</a></li>
        </ul>
        <div id="myTabContent" class="tab-content">
            <div class="tab-pane fade in active" id="_home">
                <form>
                    <br>
                    <strong>WiFi设置:</strong>
                    <hr>
                    <div id="static_ip">
                        <div class="form-group row">
                            <label for="ip" class="col-sm-4 col-form-label">无线网络:</label>
                            <div class="col-sm-6">
                                <input type="text" class="form-control" id="ssid" placeholder="">
                            </div>
                        </div>
                        <div class="form-group row">
                            <label for="mask" class="col-sm-4 col-form-label">WiFi密码:</label>
                            <div class="col-sm-6">
                                <input type="password" class="form-control" id="password" placeholder="长度16个字符以内">
                            </div>
                        </div>
                    </div>
                    <br>
                    <strong>邮箱设置:</strong>
                    <hr>
                    <div class="form-group row">
                        <label for="ip" class="col-sm-4 col-form-label">SMTP服务器:</label>
                        <div class="col-sm-6">
                            <input type="text" class="form-control" id="email_host" placeholder="smtp.126.com">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="ip" class="col-sm-4 col-form-label">服务器端口:</label>
                        <div class="col-sm-6">
                            <input type="text" class="form-control" id="email_port" placeholder="25">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="mask" class="col-sm-4 col-form-label">用户名:</label>
                        <div class="col-sm-6">
                            <input type="text" class="form-control" id="email_user" placeholder="xxxx@126.com">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="mask" class="col-sm-4 col-form-label">密码:</label>
                        <div class="col-sm-6">
                            <input type="password" class="form-control" id="email_pwd" placeholder="邮箱登录密码">
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="mask" class="col-sm-4 col-form-label">接收邮箱:</label>
                        <div class="col-sm-6">
                            <input type="text" class="form-control" id="email_rcv" placeholder="多个请用英文逗号(,)隔开">必须英文分号:
                        </div>
                        <a type="button" class="btn btn-success" style="margin-left:10px"  id="set_email">&nbsp;&nbsp;测&nbsp;&nbsp;&nbsp;试&nbsp;&nbsp;</a>
                    </div>

                </form>
            </div>
            <div class="tab-pane fade" id="_alarm">
                <form>
                    <br>
                    <strong>闹钟设置:</strong>
                    <hr>
                    <div class="form-group row">
                        <label for="status" class="col-sm-4 col-form-label">开关:</label>
                        <div class="col-sm-2">
                            <div class="form-group">
                                <input type="checkbox" checked id="status" />
                            </div>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="datetime" class="col-sm-4 col-form-label">模式:</label>
                        <div class="col-sm-6">
                            <div class="form-group ">
                                <div class="pretty p-default p-round p-thick">
                                    <input type="radio" id="repeat" onclick="radio_click()" name="alarm" checked />
                                    <div class="state p-primary-o">
                                        <label>重复</label>
                                    </div>
                                </div>
                                <label class="radio-inline"></label>
                                <label class="radio-inline"></label>
                                <div class="pretty p-default p-round p-thick">
                                    <input type="radio" id="repeat2" onclick="radio_click()" name="alarm" />
                                    <div class="state p-primary-o">
                                        <label>单次</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group row" id="date_row" hidden>
                        <label for="datetime" class="col-sm-4 col-form-label">日期:</label>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <input type="text" value="" class="form-control" id="date">
                            </div>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="datetime" class="col-sm-4 col-form-label">时间:</label>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <input type="text" value="" class="form-control" id="time">
                            </div>
                        </div>
                        <a type="button" class="btn btn-success" id="set_alarm">&nbsp;&nbsp;测&nbsp;&nbsp;&nbsp;试&nbsp;&nbsp;</a>
                    </div>
                    <br>
                    <strong>RTC设置:</strong>
                    <hr>
                    <div class="form-group row">
                        <label for="rtc_time" class="col-sm-4 col-form-label">修改时间:</label>
                        <div class="col-sm-6">
                            <input type="text" class="form-control" id="rtc_time">
                        </div>
                        <a type="button" data-toggle="tooltip" title="使用本机时间设置RTC" class="btn btn-warning" id="set_rtc_time">本机时间</a>
                    </div>
                </form>
            </div>
            <div class="tab-pane fade" id="_weather">
                <br>
                    <strong>天气API接口配置:</strong>
                    <hr>
                    <div>
                        <div class="form-group row">
                            <label for="city" class="col-sm-4 col-form-label">经纬度坐标:</label>
                            <div class="col-sm-6">
                                <input type="text" class="form-control" id="city_location" placeholder="获取的经纬度粘贴到此处">
                            </div>
                            <a class="btn btn-primary" href="https://lbs.amap.com/console/show/picker" target="_blank">地图取点</a>
                        </div>
                        <div class="form-group row">
                            <label for="city" class="col-sm-4 col-form-label">坐标名称:</label>
                            <div class="col-sm-6">
                                <input type="text" class="form-control" id="city_name" placeholder="代表坐标的名称">
                            </div>
                        </div>
                        <div class=" form-group row">
                            <label for="app_key" class="col-sm-4 col-form-label">APP Key:</label>
                            <div class="col-sm-6">
                                <input type="password" class="form-control" id="app_key" placeholder="app key">
                            </div>
                            <a type="button" class="btn btn-warning" id="check">&nbsp;&nbsp;验&nbsp;&nbsp;&nbsp;证&nbsp;&nbsp;</a>
                        </div>
                        <div class="form-group row">
                            <label for="sign" class="col-sm-4 col-form-label">更新频率:</label>
                            <div class="col-sm-6">
                                <input type="text" class="form-control" id="update_period" placeholder="单位分钟">
                            </div>
                            1~120分钟
                        </div>
                        
                    </div>
            </div>
            <div class="tab-pane fade" id="_tips">
                
                <br>
                <strong>备忘录:</strong>
                <hr>
                <div class="form-group row">
                    <label for="server" class="col-sm-4 col-form-label">内容:</label>
                    <div class="col-sm-6">
                        <textarea type="text" maxlength="40" placeholder="长度不超过40个英文字符或20个中文" class="form-control" id="tips"></textarea>
                    </div>
                    <a type="button" class="btn btn-success" id="set_tips">&nbsp;&nbsp;测&nbsp;&nbsp;&nbsp;试&nbsp;&nbsp;</a>
                </div>
                <br>
                <strong>待办事项:</strong>
                <hr>
                <div class="form-group row">
                    <!-- <label for="server" class="col-sm-1 col-form-label"></label> -->
                    <div class="col-sm-10">
                        <input type="text" placeholder="1.长度不超过60个英文字符或30个中文" class="form-control"maxlength="60"id="to-do-list-1"></input>
                    </div>
                </div>
                <div class="form-group row">
                    <!-- <label for="server" class="col-sm-1 col-form-label">2.</label> -->
                    <div class="col-sm-10">
                        <input type="text" placeholder="2.长度不超过60个英文字符或30个中文" class="form-control" maxlength="60" id="to-do-list-2"></input>
                    </div>
                </div>
                                <div class="form-group row">
                    <!-- <label for="server" class="col-sm-1 col-form-label">2.</label> -->
                    <div class="col-sm-10">
                        <input type="text" placeholder="3.长度不超过60个英文字符或30个中文" class="form-control" maxlength="60"  id="to-do-list-3"></input>
                    </div>
                </div>
                <div class="form-group row">
                    <!-- <label for="server" class="col-sm-1 col-form-label">2.</label> -->
                    <div class="col-sm-10">
                        <input type="text" placeholder="4.长度不超过60个英文字符或30个中文" class="form-control" maxlength="60" id="to-do-list-4"></input>
                    </div>
                </div>
                <div class="form-group row">
                    <!-- <label for="server" class="col-sm-1 col-form-label">2.</label> -->
                    <div class="col-sm-10">
                        <input type="text" placeholder="5.长度不超过60个英文字符或30个中文" class="form-control" maxlength="60" id="to-do-list-5"></input>
                    </div>
                </div>
                <div class="form-group row">
                    <!-- <label for="server" class="col-sm-1 col-form-label">2.</label> -->
                    <div class="col-sm-10">
                        <input type="text" placeholder="6.长度不超过60个英文字符或30个中文" class="form-control" maxlength="60" id="to-do-list-6"></input>
                    </div>
                </div>
                <div class="form-group row">
                    <!-- <label for="server" class="col-sm-1 col-form-label">2.</label> -->
                    <div class="col-sm-10">
                        <input type="text" placeholder="7.长度不超过60个英文字符或30个中文" class="form-control" maxlength="60" id="to-do-list-7"></input>
                    </div>
                </div>
                <div class="form-group row">
                    <!-- <label for="server" class="col-sm-1 col-form-label">2.</label> -->
                    <div class="col-sm-10">
                        <input type="text" placeholder="8.长度不超过60个英文字符或30个中文" class="form-control" maxlength="60" id="to-do-list-8"></input>
                    </div>
                </div>
                <div class="form-group row">
                    <!-- <label for="server" class="col-sm-1 col-form-label">2.</label> -->
                    <div class="col-sm-10">
                        <input type="text" placeholder="9.长度不超过60个英文字符或30个中文" class="form-control" maxlength="60" id="to-do-list-9"></input>
                    </div>
                </div>
                <div class="form-group row">
                    <!-- <label for="server" class="col-sm-1 col-form-label">2.</label> -->
                    <div class="col-sm-10">
                        <input type="text" placeholder="10.长度不超过60个英文字符或30个中文" class="form-control" maxlength="60" id="to-do-list-10"></input>
                    </div>
                </div>
                <a type="button" class="btn btn-success" id="set_to_do_list">&nbsp;&nbsp;测&nbsp;&nbsp;&nbsp;试&nbsp;&nbsp;</a>
            </div>
            <div class="tab-pane fade" id="_other">
                <br>
                <strong>屏幕亮度:</strong>
                <hr>
                <br>
                <div class="form-group row">
                    <label for="server" class="col-sm-4 col-form-label">亮度:</label>
                    <div class="col-sm-6">
                        <div style="height: auto;">
                            <strong>0</strong>
                            <input id="brightness" data-slider-id='brightness-slider' type="text" data-slider-min="0"
                                data-slider-max="100" data-slider-step="1" data-slider-value="50" />
                            <strong>100</strong>
                        </div>
                    </div>
                </div>
                <br>
                <strong>播报时段:</strong>
                <hr>
                <br>
                <div class="form-group row">
                    <label for="status" class="col-sm-4 col-form-label">开关:</label>
                    <div class="col-sm-2">
                        <div class="form-group">
                            <input type="checkbox" checked id="voice_status" />
                        </div>
                    </div>
                </div>
                <div class="form-group row">
                    <label for="server" class="col-sm-4 col-form-label">时段:</label>
                    <div class="col-sm-6">
                        <div style="height: auto;">
                            <strong>0&nbsp;&nbsp;</strong>
                            <input id="voice-slider"type="text"/>
                            <strong>&nbsp;&nbsp;23</strong>
                        </div>
                    </div>
                    <a type="button" class="btn btn-success" id="set_voice">&nbsp;&nbsp;测&nbsp;&nbsp;&nbsp;试&nbsp;&nbsp;</a>
                </div>
                <br>
                <strong>默认页面:</strong>
                <hr>
                <div class="form-group row">
                    <label for="server" class="col-sm-4 col-form-label">选择页面:</label>
                    <div class="col-sm-6">
                        <select id="default_page" class="form-control">
                            <option value="0">桌面</option>
                            <option value="1">气象站</option>
                            <option value="2">万年历</option>
                            <option value="3">空气质量</option>
                            <option value="4">模拟时钟</option>
                            <option value="5">数字时钟</option>
                            <option value="6">温湿度</option>
                            <option value="7">备忘录</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="tab-pane fade" id="_temp">
                <br>
                <strong>温度报警设置:</strong>
                <hr>
                <div class="form-group row">
                <label for="temp_alarm" class="col-sm-4 col-form-label">开关:</label>
                <div class="col-sm-4">
                    <div class="form-group">
                        <input type="checkbox"  id="temp_alarm" />
                    </div>
                </div>
                </div>
                 <div class="form-group row">
                <label for="temp_alarm" class="col-sm-4 col-form-label">条件:</label>
                <div class="col-sm-4">
                    <select id="temp_exp" class="form-control">
                        <option value="&gt;">大于</option>
                        <option value="&gt;=">大于等于</option>
                        <option value="=">等于</option>
                        <option value="&lt;">小于</option>
                        <option value="&lt;=">小于等于</option>
                    </select>
                </div>
                <div class="col-sm-2">
                    <input type="text" class="form-control" id="temp">
                </div>
                 </div>
                <div class="form-group row">
                    <label for="temp_alarm" class="col-sm-4 col-form-label">动作:</label>
                    <div class="col-sm-4">
                        <select id="temp_alarm_action" class="form-control">
                            <option value="0">蜂鸣报警</option>
                            <option value="1">语音报警</option>
                            <option value="2">邮件通知</option>
                        </select>
                    </div>
                    <a type="button" class="btn btn-success" style="margin-left:10px"  id="set_temp_alarm">&nbsp;&nbsp;测&nbsp;&nbsp;&nbsp;试&nbsp;&nbsp;</a>
                </div>
                <br>
                <strong>湿度报警设置:</strong>
                <hr>
                <div class="form-group row">
                <label for="huim_alarm" class="col-sm-4 col-form-label">开关:</label>
                <div class="col-sm-4">
                    <div class="form-group">
                        <input type="checkbox"  id="huim_alarm" />
                    </div>
                </div>
                </div>
                 <div class="form-group row">
                <label for="huim_alarm" class="col-sm-4 col-form-label">条件:</label>
                <div class="col-sm-4">
                    <select id="huim_exp" class="form-control">
                        <option value="&gt;">大于</option>
                        <option value="&gt;=">大于等于</option>
                        <option value="=">等于</option>
                        <option value="&lt;">小于</option>
                        <option value="&lt;=">小于等于</option>
                    </select>   
                </div>
                <div class="col-sm-2">
                    <input type="text" class="form-control" id="huim">
                </div>
            </div>
            <div class="form-group row">
                <label for="huim_alarm" class="col-sm-4 col-form-label">动作:</label>
                <div class="col-sm-4">
                    <select id="huim_alarm_action" class="form-control">
                        <option value="0">蜂鸣报警</option>
                        <option value="1">语音报警</option>
                        <option value="2">邮件通知</option>
                    </select>
                </div>
                <a type="button" class="btn btn-success" style="margin-left:10px"  id="set_huim_alarm">&nbsp;&nbsp;测&nbsp;&nbsp;&nbsp;试&nbsp;&nbsp;</a>
                </div>
            </div>
            <div class="tab-pane fade" id="_about">
                <!-- <h3 style="color: darkcyan;">ESP32 多功能桌面气象站</h3> -->
                <p>使用文档位置: <a href="https://xfdr0805.github.io" target="_blank">电梯直达</a></p>
                <p>如果不能访问,请访问这个连接: <a href="https://xfdr0805.gitee.io" target="_blank">准备起飞</a></p>
                <br>
                <br>

                <p style="color: darkcyan;">导入导出配置文件 --- 暂未实现</p>
                    <a type="button" class="btn btn-success" style="margin-left:10px"  id="export">导出配置</a>
                <br>
                <br>
                <a type="button" class="btn btn-success" style="margin-left:10px"  id="import">导入配置</a>
             </div>
        </div>
        <hr>
        <div class="form-group row">
            <label for="confirm" class="col-sm-4 col-form-label"></label>
            <div class="col-sm-6">
                <a type="button" class="btn btn-info"
                    id="confirm">&nbsp;&nbsp;提&nbsp;&nbsp;&nbsp;交&nbsp;&nbsp;</a>
                <a type="button" class="btn btn-danger" style="margin-left: 60px;"
                    id="restart">&nbsp;&nbsp;重&nbsp;&nbsp;&nbsp;启&nbsp;&nbsp;</a>
            </div>
        </div>
    </div>
    <div style="height: 60px;"></div>
    <footer class="footer">
        <div class="container">
            <div style="text-align: center">Copyright 2020-2030 xfdr0805 All Rights Reserved.</div>
        </div>
    </footer>
    <script src="https://widget.heweather.net/standard/static/js/he-standard-common.js?v=1.1"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/layer/3.1.1/layer.js"></script>
    <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://s1.pstatp.com/cdn/expire-1-M/moment.js/2.24.0/moment-with-locales.min.js"></script>
    <script src="https://s3.pstatp.com/cdn/expire-1-M/bootstrap-slider/10.6.1/bootstrap-slider.min.js"></script>
    <script
        src="https://s2.pstatp.com/cdn/expire-1-M/bootstrap-datetimepicker/4.17.47/js/bootstrap-datetimepicker.min.js">
    </script>
    <script src="https://s0.pstatp.com/cdn/expire-1-M/bootstrap-switch/3.3.4/js/bootstrap-switch.min.js"></script>

</body>

<script>
    WIDGET = {
        CONFIG: {
            "layout": 1,
            "width": 575,
            "height": 150,
            "background": 1,
            "dataColor": "FFFFFF",
            "borderRadius": 5,
            "key": "165c030ef5484bc9a3781a339b125a3e"
        }
    }
    $("#status,#temp_alarm,#huim_alarm,#voice_status").bootstrapSwitch({
        onText: "ON", // 设置ON文本 ?
        offText: "OFF", // 设置OFF文本 ?
        onColor: "success", // 设置ON文本颜色 ? ? (info/success/warning/danger/primary) ?
        offColor: "danger", // 设置OFF文本颜色 ? ? ? ?(info/success/warning/danger/primary) ?
        size: "normal", // 设置控件大小,从小到大 ?(mini/small/normal/large) ?
        // 当开关状态改变时触发 ?
        onSwitchChange: function (event, state) {
            if (state == true) {
                //layer.alert("ON");
                $(this).val(true);
            } else {
                //layer.alert("OFF");
                $(this).val(false);
            }
        }
    });
    var cnt_rtc = 0;
    var cnt_ntp = 0;
    $(function(){
        $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
            // 获取已激活的标签页的名称
            var activeTab = $(e.target).text(); 
            // 获取前一个激活的标签页的名称
            var previousTab = $(e.relatedTarget).text(); 
            $(".active-tab span").html(activeTab);
            $(".previous-tab span").html(previousTab);
        });
    });
    $(document).ready(function () {

        $.ajax({
            type: 'POST',
            url: "/get_config",
            data: "",
            dataType: 'json',
            success: function (data) {
                $("#ssid").val(data["wifi"]["ssid"]);
                $("#password").val(data["wifi"]["password"]);
                $("#email_host").val(data["email"]["host"]);
                $("#email_port").val(data["email"]["port"]);
                $("#email_user").val(data["email"]["username"]);
                $("#email_pwd").val(data["email"]["password"]);
                $("#email_rcv").val(data["email"]["receiver"]);
                $("#city_location").val(data["weather"]["location"]);
                $("#city_name").val(data["weather"]["city_name"]);
                $("#app_key").val(data["weather"]["app_key"]);
                $("#server").val(data["ntp_server"]);
                $("#update_period").val(parseInt(data["weather"]["update_period"]) / 60);
                var mode = data["alarm"]["mode"];
                if (mode == "repeat") {
                    $("#date_row").hide();
                    //$("#repeat").prop("checked", "checked");
                    //$("#repeat1").removeAttr("checked");
                } else {
                    $("#date_row").show();
                    //$("#repeat").removeAttr("checked");
                    //$("#repeat1").prop("checked", "checked");
                }
                //$("#status").prop("checked", data["alarm"]["status"]);
                //$("#temp_alarm").prop("checked", data["dht_sensor"]["temp_alarm"]);
                //$("#huim_alarm").prop("checked", data["dht_sensor"]["huim_alarm"]);
                $("#status").bootstrapSwitch('state', data["alarm"]["status"]);
                $("#temp_alarm").bootstrapSwitch('state',data["dht_sensor"]["temp_alarm"]);
                $("#huim_alarm").bootstrapSwitch('state',data["dht_sensor"]["huim_alarm"]);
                $("#temp").val(data["dht_sensor"]["temp"]);
                $("#temp_exp").val(data["dht_sensor"]["temp_exp"]);
                $("#temp_alarm_action").val(data["dht_sensor"]["temp_alarm_action"]);
                $("#huim").val(data["dht_sensor"]["huim"]);
                $("#huim_exp").val(data["dht_sensor"]["huim_exp"]);
                $("#huim_alarm_action").val(data["dht_sensor"]["huim_alarm_action"]);
                $("#date").val(data["alarm"]["date"]);
                $("#time").val(data["alarm"]["time"]);
                $("#tips").val(data["tips"]);
                var id = "#to-do-list-";
                for(var i=1;i<=10;i++)
                {
                    $(id+i).val(data["to_do_list"][i-1]);   
                }
                $("#brightness").data('slider').setValue(data["brightness"]);
                $("#voice-slider").data('slider').setValue(data["voice"]["time"]);
                $("#voice_status").bootstrapSwitch('state', data["voice"]["status"]);
                $("#default_page").val(data["default_page"]);
            },
            error: function (data) {
                console.log('获取数据失败！');
            },
        });
    });
    $("#voice-slider").slider({
         min: 0, max: 23, value: [7, 21],tooltip: 'always',
        formatter: function (value) {
            return '播报时段: ' + value[0] + '点-' + value[1] + "点";
        }});
    $('#brightness').slider({
        tooltip: 'always',
        formatter: function (value) {
            return '亮度: ' + value;
        }
    });
    $("#set_voice").click(function(){
        $.ajax({
            type: 'POST',
            url: "/set_voice",
            data: "{}",
            dataType: 'json',
            success: function (data) {
                if (data.status == "success") {
                    //layer.msg("参数保存成功")
                }
            },
            error: function (data) {
                console.log('获取数据失败！');
            },
        });
    });
    $('#brightness').on("slideStop", function (event) {
        //console.log("亮度:" + event.value);
        console.log("亮度:" + $("#brightness").data('slider').getValue());
        var brightness = {
            'brightness': parseInt(event.value),
        };
        $.ajax({
            type: 'POST',
            url: "/set_brightness",
            data: JSON.stringify(brightness),
            dataType: 'json',
            success: function (data) {
                if (data.status == "success") {
                    //layer.msg("参数保存成功")
                }
            },
            error: function (data) {
                console.log('获取数据失败！');
            },
        });
    })
    $("#rtc_time").datetimepicker({
        format: 'YYYY-MM-DD HH:mm:ss',
        locale: moment.locale('zh-CN'),
    });
    $("#set_rtc_time").click(function(){
        var date_time = $("#rtc_time").val();
        var dat = new Date(date_time);
        //console.log(date.toDateString().substring(date.toDateString().indexOf(" ")+1));
        var date = dat.toDateString().substring(dat.toDateString().indexOf(" ")+1);
        var time = date_time.substring(11);
        //console.log(time);
        //转换成ISO标准格式，方便调整时间
        var date_time = {
            'date': date,
            'time': time,
        };
        $.ajax({
            type: 'POST',
            url: "/set_rtc",
            data: JSON.stringify(date_time),
            dataType: 'json',
            success: function (data) {
                if (data.status == "success") {
                    layer.msg("RTC修改成功！");
                }
            },
            error: function (data) {
                console.log('获取数据失败！');
            },
        });
    });
    // $('#brightness').on("change", function (event) {
    //     console.log("value:" + event.value.oldValue);
    // })
    $('#set_tips').click(function () {
        var tips = {
            'tips': $("#tips").val(),
        };
        $.ajax({
            type: 'POST',
            url: "/set_tips",
            data: JSON.stringify(tips),
            dataType: 'json',
            success: function (data) {
                if (data.status == "success") {
                    layer.msg("成功！")
                }
            },
            error: function (data) {
                console.log('获取数据失败！');
            },
        });
    });
    $('#set_to_do_list').click(function () {
        var array = new Array();
        var id = "#to-do-list-";
        for(var i=1;i<=10;i++)
        {
            array[i-1]=$(id+i).val();   
        }
        var to_do_list = {
            'to_do_list': array,
        };
        console.log(to_do_list);
        $.ajax({
            type: 'POST',
            url: "/set_to_do_list",
            data: JSON.stringify(to_do_list),
            dataType: 'json',
            success: function (data) {
                if (data.status == "success") {
                    layer.msg("成功！")
                }
            },
            error: function (data) {
                console.log('获取数据失败！');
            },
        });
    });
    $('#set_alarm').click(function () {
        var mode = "repeat";
        if ($("#repeat").prop("checked") == true) {
            mode = "repeat";
        } else {
            mode = "once";
        }
        var status = $("#status").prop("checked");
        var alarm = {
            'mode': mode,
            'status': status,
            'date': $("#date").val(),
            'time': $("#time").val()
        };
        $.ajax({
            type: 'POST',
            url: "/set_alarm",
            data: JSON.stringify(alarm),
            dataType: 'json',
            success: function (data) {
                if (data.status == "success") {
                    layer.msg("执行成功!");
                }
            },
            error: function (data) {
                console.log('获取数据失败！');
            },
        });
    });
    $('#set_temp_alarm').click(function () {
        var temp_alarm = {
                "temp_exp":$("#temp_exp").val(),
                "temp":parseInt($("#temp").val()),
                "temp_alarm":$("#temp_alarm").val()=="true"?true:false,
                "temp_alarm_action":$("#temp_alarm_action").val(),
        }
        $.ajax({
            type: 'POST',
            url: "/set_temp_alarm",
            data: JSON.stringify(temp_alarm),
            dataType: 'json',
            success: function (data) {
                if (data.status == "success") {
                    layer.msg("执行成功!");
                }
            },
            error: function (data) {
                console.log('获取数据失败！');
            },
        });
    });
    $('#set_huim_alarm').click(function () {
        var huim_alarm = {
                "huim_exp":$("#huim_exp").val(),
                "huim":parseInt($("#huim").val()),
                "huim_alarm": $("#huim_alarm").val()=="true"?true:false,
                "huim_alarm_action":$("#huim_alarm_action").val()
        }
        $.ajax({
            type: 'POST',
            url: "/set_huim_alarm",
            data: JSON.stringify(huim_alarm),
            dataType: 'json',
            success: function (data) {
                if (data.status == "success") {
                    layer.msg("执行成功!");
                }
            },
            error: function (data) {
                console.log('获取数据失败！');
            },
        });
    });
    $('#set_email').click(function () {
        var email_cfg = {
                "host":$("#email_host").val(),
                "port":parseInt($("#email_port").val()),
                "username":$("#email_user").val(),
                "password":$("#email_pwd").val(),
                "receiver":$("#email_rcv").val()
        }
        $.ajax({
            type: 'POST',
            url: "/set_email",
            data: JSON.stringify(email_cfg),
            dataType: 'json',
            success: function (data) {
                if (data.status == "success") {
                    layer.msg("执行成功!");
                }
            },
            error: function (data) {
                console.log('获取数据失败！');
            },
        });
    });
    $("#time").datetimepicker({
                format: 'HH:mm:ss',
                locale: moment.locale('zh-CN')
            });
    function radio_click() {
        if ($("#repeat").prop("checked") == true) {
            //format = 'HH:mm:ss';
            $("#date_row").hide();
        } else {
            //format = 'YYYY-MM-DD HH:mm:ss';
            $("#date_row").show();
            $("#date").datetimepicker({
                format: 'YYYY-MM-DD',
                locale: moment.locale('zh-CN'),
            });
            $("#time").datetimepicker({
                format: 'HH:mm:ss',
                locale: moment.locale('zh-CN')
            });
        }
    }

    $('#restart').click(function () {
        $.ajax({
            type: 'POST',
            url: "/restart",
            data: "",
            dataType: 'json',
            success: function (data) {
                if (data.status == "success") {
                    layer.msg("执行成功")
                }
            },
            error: function (data) {
                console.log('获取数据失败！');
            },
        });
    });

    function strlen(str) {
        var len = 0;
        for (var i = 0; i < str.length; i++) {
            var c = str.charCodeAt(i);
            //单字节加1
            if ((c >= 0x0001 && c <= 0x007e) || (0xff60 <= c && c <= 0xff9f)) {
                len++;
            } else {
                len += 2;
            }
        }
        return len;
    }
 

    $("#check").click(function () {
        var location = $("#city_location").val();
        var app_key = $("#app_key").val();
        //console.log(location);
        console.log(app_key);
        var url = "https://search.heweather.net/find?" + "key=" + app_key + "&location=" + location;
        $.ajax({
            type: 'POST',
            url: url,
            dataType: 'json',
            success: function (data) {
                if (data["HeWeather6"][0]["status"] == "ok") {
                    var name = data["HeWeather6"][
                            0
                        ][
                            "basic"
                        ][0][
                            "admin_area"
                        ] +
                        " " + data["HeWeather6"][0]["basic"][0]["parent_city"] +
                        " " + data["HeWeather6"][0]["basic"][0]["location"];
                    $("#city_name").val(name);
                } else {
                    layer.alert(data["HeWeather6"][0]["status"]);

                }
            },
            error: function (data) {
                layer.alert("请求失败!");
            },
        });
    });
    $('#confirm').click(function () {
        var ssid = $("#ssid").val();
        var password = $("#password").val();
        var city_location = $("#city_location").val();
        var city_name = $("#city_name").val();
        var app_key = $("#app_key").val();
        var ntp_server = $("#server").val();
        var tips = $("#tips").val();
        var brightness = $("#brightness").data('slider').getValue();
        var voice_time = $("#voice-slider").data('slider').getValue();
        var update_period = parseInt($("#update_period").val()) * 60;
        if (strlen(city_name) > 16) {
            layer.msg("坐标名称长度过长<br>不能超过8个中文或16个英文字符！")
            return;
        }
        if (strlen(tips) > 40) {
            layer.msg("备忘录内容过长,<br>不能超过20个中文或40个英文字符！")
            return;
        }
        var mode = "repeat";
        if ($("#repeat").prop("checked") == true) {
            mode = "repeat";
        } else {
            mode = "once";
        }
        var status = $("#status").prop("checked");
        var date = $("#date").val();
        var time = $("#time").val();
        var array = new Array();
        var id = "#to-do-list-";
        for(var i=1;i<=10;i++)
        {
            array[i-1]=$(id+i).val();   
        }
        
        var config = {
            "weather": {
                "location": city_location,
                "app_key": app_key,
                "update_period": update_period,
                "city_name": city_name
            },
            "wifi": {
                "ssid": ssid,
                "password": password
            },
            "alarm": {
                "status": status,
                "mode": mode,
                "date": date,
                "time": time,
            },
            "email":{
                "host":$("#email_host").val(),
                "port":parseInt($("#email_port").val()),
                "username":$("#email_user").val(),
                "password":$("#email_pwd").val(),
                "receiver":$("#email_rcv").val()
            },
            "dht_sensor":{
                "temp_exp":$("#temp_exp").val(),
                "temp":parseInt($("#temp").val()),
                "temp_alarm":$("#temp_alarm").val()=="true"?true:false,
                "temp_alarm_action":$("#temp_alarm_action").val(),
                "huim_exp":$("#huim_exp").val(),
                "huim":parseInt($("#huim").val()),
                "huim_alarm": $("#huim_alarm").val()=="true"?true:false,
                "huim_alarm_action":$("#huim_alarm_action").val()
            },
            "to_do_list":array,
            "default_page": $("#default_page").val(),
            "tips": tips,
            "brightness": brightness,
            "voice":{
                "time":voice_time,
                "status":$("#voice_status").prop("checked")
            },


        }
        $.ajax({
            type: 'POST',
            url: "/set_config",
            data: JSON.stringify(config),
            dataType: 'json',
            success: function (data) {
                if (data.status == "success") {
                    layer.msg("参数保存成功,重启后生效！")
                }
            },
            error: function (data) {
                console.log('获取数据失败！');
            },
        });
    });
</script>
</body>

</html>]]></content>
      <categories>
        <category>ESP32桌面气象站-LCD触控版</category>
      </categories>
      <tags>
        <tag>ESP32</tag>
        <tag>firmware</tag>
      </tags>
  </entry>
  <entry>
    <title>v3s-bt-audio</title>
    <url>/2021/08/29/Linux/v3s-bt-audio/</url>
    <content><![CDATA[<h2 id="全志V3S上通过蓝牙播放音乐"><a href="#全志V3S上通过蓝牙播放音乐" class="headerlink" title="全志V3S上通过蓝牙播放音乐"></a>全志V3S上通过蓝牙播放音乐</h2><p><code>我使用的是RTL8723DS模块，引脚与BS是兼容的，内核使用的是5.10, Bluez使用的是5.55 终端是UART0，蓝牙串口使用的是UART2，板子是参照licheepi 自己画的</code></p>
<p><a href="https://gitee.com/yocop/drv_bt_rtl8723ds">参考链接</a><br><a href="https://github.com/Poco-Ye/rtl8723DS-BT-uart-driver">BT参考链接</a><br><a href="https://github.com/lwfinger/rtl8723ds">WIFI参考链接</a></p>
<img src="/2021/08/29/Linux/v3s-bt-audio/2021-07-28_T.png" class="" title="top">
<img src="/2021/08/29/Linux/v3s-bt-audio/2021-07-28_B.png" class="" title="top">
<ol>
<li><p>首先在buildroot里勾选上bluez5-utils,bluez-tools及blue-alsa</p>
</li>
<li><p>在内核里勾选</p>
<pre><code> [*]UART(H4) protocol support
 [*]Realtek Three-wireUART(H5) protocol support</code></pre>
<p> 系统启动时会显示如下信息：</p>
<pre><code> Starting kernel ...

 [    0.000000] Booting Linux on physical CPU 0x0
 [    0.000000] Linux version 5.10.19 (xfdr@virtualbox) (arm-linux-gnueabihf-gcc (Linaro GCC 7.5-2019.12) 7.5.0, GNU ld (Linaro_Binutils-2019.12) 2.28.2.20170706) #13 SMP Fri Jul 23 12:00:59 CST 2021
 [    0.000000] CPU: ARMv7 Processor [410fc075] revision 5 (ARMv7), cr=10c5387d
 [    0.000000] CPU: div instructions available: patching division code
 [    0.000000] CPU: PIPT / VIPT nonaliasing data cache, VIPT aliasing instruction cache
 [    0.000000] OF: fdt: Machine model: Lichee Pi Zero with Dock
 [    0.000000] Memory policy: Data cache writealloc
 [    0.000000] cma: Reserved 16 MiB at 0x41c00000
 [    0.000000] Zone ranges:
 [    0.000000]   Normal   [mem 0x0000000040000000-0x0000000043ffffff]
 [    0.000000]   HighMem  empty
 [    0.000000] Movable zone start for each node
 [    0.000000] Early memory node ranges
 [    0.000000]   node   0: [mem 0x0000000040000000-0x0000000043ffffff]
 [    0.000000] Initmem setup node 0 [mem 0x0000000040000000-0x0000000043ffffff]
 [    0.000000] psci: probing for conduit method from DT.
 [    0.000000] psci: Using PSCI v0.1 Function IDs from DT
 [    0.000000] percpu: Embedded 15 pages/cpu s31052 r8192 d22196 u61440
 [    0.000000] Built 1 zonelists, mobility grouping on.  Total pages: 16256
 [    0.000000] Kernel command line: console=ttyS0,115200 panic=5 console=ttyS0 rootwait vt.global_cursor_default=0 root=/dev/mmcblk0p2 earlyprintk rw
 [    0.000000] Dentry cache hash table entries: 8192 (order: 3, 32768 bytes, linear)
 [    0.000000] Inode-cache hash table entries: 4096 (order: 2, 16384 bytes, linear)
 [    0.000000] mem auto-init: stack:off, heap alloc:off, heap free:off
 [    0.000000] Memory: 34900K/65536K available (8192K kernel code, 918K rwdata, 2244K rodata, 1024K init, 284K bss, 14252K reserved, 16384K cma-reserved, 0K highmem)
 [    0.000000] SLUB: HWalign=64, Order=0-3, MinObjects=0, CPUs=1, Nodes=1
 [    0.000000] rcu: Hierarchical RCU implementation.
 [    0.000000] rcu:     RCU restricting CPUs from NR_CPUS=8 to nr_cpu_ids=1.
 [    0.000000] rcu: RCU calculated value of scheduler-enlistment delay is 10 jiffies.
 [    0.000000] rcu: Adjusting geometry for rcu_fanout_leaf=16, nr_cpu_ids=1
 [    0.000000] NR_IRQS: 16, nr_irqs: 16, preallocated irqs: 16
 [    0.000000] GIC: Using split EOI/Deactivate mode
 [    0.000000] random: get_random_bytes called from start_kernel+0x328/0x4c0 with crng_init=0
 [    0.000000] arch_timer: cp15 timer(s) running at 24.00MHz (phys).
 [    0.000000] clocksource: arch_sys_counter: mask: 0xffffffffffffff max_cycles: 0x588fe9dc0, max_idle_ns: 440795202592 ns
 [    0.000008] sched_clock: 56 bits at 24MHz, resolution 41ns, wraps every 4398046511097ns
 [    0.000022] Switching to timer-based delay loop, resolution 41ns
 [    0.000278] clocksource: timer: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 79635851949 ns
 [    0.000593] Console: colour dummy device 80x30
 [    0.000661] Calibrating delay loop (skipped), value calculated using timer frequency.. 48.00 BogoMIPS (lpj=240000)
 [    0.000684] pid_max: default: 32768 minimum: 301
 [    0.000852] Mount-cache hash table entries: 1024 (order: 0, 4096 bytes, linear)
 [    0.000873] Mountpoint-cache hash table entries: 1024 (order: 0, 4096 bytes, linear)
 [    0.001748] CPU: Testing write buffer coherency: ok
 [    0.002186] /cpus/cpu@0 missing clock-frequency property
 [    0.002218] CPU0: thread -1, cpu 0, socket 0, mpidr 80000000
 [    0.002989] Setting up static identity map for 0x40100000 - 0x40100060
 [    0.003218] rcu: Hierarchical SRCU implementation.
 [    0.003764] smp: Bringing up secondary CPUs ...
 [    0.003792] smp: Brought up 1 node, 1 CPU
 [    0.003802] SMP: Total of 1 processors activated (48.00 BogoMIPS).
 [    0.003811] CPU: All CPU(s) started in HYP mode.
 [    0.003818] CPU: Virtualization extensions available.
 [    0.004452] devtmpfs: initialized
 [    0.008373] VFP support v0.3: implementor 41 architecture 2 part 30 variant 7 rev 5
 [    0.008733] clocksource: jiffies: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 19112604462750000 ns
 [    0.008771] futex hash table entries: 256 (order: 2, 16384 bytes, linear)
 [    0.009561] pinctrl core: initialized pinctrl subsystem
 [    0.011091] NET: Registered protocol family 16
 [    0.012326] DMA: preallocated 256 KiB pool for atomic coherent allocations
 [    0.013612] thermal_sys: Registered thermal governor &#39;step_wise&#39;
 [    0.014006] hw-breakpoint: found 5 (+1 reserved) breakpoint and 4 watchpoint registers.
 [    0.014032] hw-breakpoint: maximum watchpoint size is 8 bytes.
 [    0.036802] SCSI subsystem initialized
 [    0.037553] usbcore: registered new interface driver usbfs
 [    0.037622] usbcore: registered new interface driver hub
 [    0.037689] usbcore: registered new device driver usb
 [    0.037967] mc: Linux media interface: v0.10
 [    0.038015] videodev: Linux video capture interface: v2.00
 [    0.038161] pps_core: LinuxPPS API ver. 1 registered
 [    0.038174] pps_core: Software ver. 5.3.6 - Copyright 2005-2007 Rodolfo Giometti &lt;giometti@linux.it&gt;
 [    0.038198] PTP clock support registered
 [    0.038880] Advanced Linux Sound Architecture Driver Initialized.
 [    0.039575] Bluetooth: Core ver 2.22
 [    0.039667] NET: Registered protocol family 31
 [    0.039679] Bluetooth: HCI device and connection manager initialized
 [    0.039703] Bluetooth: HCI socket layer initialized
 [    0.039717] Bluetooth: L2CAP socket layer initialized
 [    0.039750] Bluetooth: SCO socket layer initialized
 [    0.040956] clocksource: Switched to clocksource arch_sys_counter
 [    0.052288] NET: Registered protocol family 2
 [    0.053034] tcp_listen_portaddr_hash hash table entries: 512 (order: 0, 6144 bytes, linear)
 [    0.053084] TCP established hash table entries: 1024 (order: 0, 4096 bytes, linear)
 [    0.053112] TCP bind hash table entries: 1024 (order: 1, 8192 bytes, linear)
 [    0.053136] TCP: Hash tables configured (established 1024 bind 1024)
 [    0.053298] UDP hash table entries: 256 (order: 1, 8192 bytes, linear)
 [    0.053357] UDP-Lite hash table entries: 256 (order: 1, 8192 bytes, linear)
 [    0.053602] NET: Registered protocol family 1
 [    0.054648] RPC: Registered named UNIX socket transport module.
 [    0.054681] RPC: Registered udp transport module.
 [    0.054690] RPC: Registered tcp transport module.
 [    0.054698] RPC: Registered tcp NFSv4.1 backchannel transport module.
 [    0.056301] Initialise system trusted keyrings
 [    0.056732] workingset: timestamp_bits=30 max_order=14 bucket_order=0
 [    0.063874] NFS: Registering the id_resolver key type
 [    0.063951] Key type id_resolver registered
 [    0.063960] Key type id_legacy registered
 [    0.064015] ntfs: driver 2.1.32 [Flags: R/W].
 [    0.163771] Key type asymmetric registered
 [    0.163804] Asymmetric key parser &#39;x509&#39; registered
 [    0.163906] Block layer SCSI generic (bsg) driver version 0.4 loaded (major 246)
 [    0.163922] io scheduler mq-deadline registered
 [    0.163931] io scheduler kyber registered
 [    0.168836] sun8i-v3s-pinctrl 1c20800.pinctrl: initialized sunXi PIO driver
 [    0.169687] sun8i-v3s-pinctrl 1c20800.pinctrl: supply vcc-pb not found, using dummy regulator
 [    0.170628] pwm-backlight backlight: supply power not found, using dummy regulator
 [    0.171287] pwm-backlight backlight: invalid default brightness level: 100, using 6
 [    0.239906] Serial: 8250/16550 driver, 8 ports, IRQ sharing disabled
 [    0.244637] printk: console [ttyS0] disabled
 [    0.264964] 1c28000.serial: ttyS0 at MMIO 0x1c28000 (irq = 45, base_baud = 1500000) is a U6_16550A
 [    0.932953] printk: console [ttyS0] enabled
 [    0.938208] sun8i-v3s-pinctrl 1c20800.pinctrl: supply vcc-pe not found, using dummy regulator
 [    0.968606] 1c28400.serial: ttyS1 at MMIO 0x1c28400 (irq = 46, base_baud = 1500000) is a U6_16550A
 [    0.999932] 1c28800.serial: ttyS2 at MMIO 0x1c28800 (irq = 47, base_baud = 1500000) is a U6_16550A
 [    1.014962] panel-simple panel: supply power not found, using dummy regulator
 [    1.022545] panel-simple panel: Specify missing connector_type
 [    1.030391] libphy: Fixed MDIO Bus: probed
 [    1.035212] CAN device driver interface
 [    1.039657] dwmac-sun8i 1c30000.ethernet: IRQ eth_wake_irq not found
 [    1.046143] dwmac-sun8i 1c30000.ethernet: IRQ eth_lpi not found
 [    1.052210] dwmac-sun8i 1c30000.ethernet: No regulator found
 [    1.057984] dwmac-sun8i 1c30000.ethernet: PTP uses main clock
 [    1.064221] dwmac-sun8i 1c30000.ethernet: No HW DMA feature register supported
 [    1.071527] dwmac-sun8i 1c30000.ethernet: RX Checksum Offload Engine supported
 [    1.078747] dwmac-sun8i 1c30000.ethernet: COE Type 2
 [    1.083730] dwmac-sun8i 1c30000.ethernet: TX Checksum insertion supported
 [    1.090514] dwmac-sun8i 1c30000.ethernet: Normal descriptors
 [    1.096184] dwmac-sun8i 1c30000.ethernet: Chain mode enabled
 [    1.101867] dwmac-sun8i 1c30000.ethernet: device MAC address d6:56:90:e0:09:09
 [    1.109732] libphy: stmmac: probed
 [    1.114430] dwmac-sun8i 1c30000.ethernet: Found internal PHY node
 [    1.121248] libphy: mdio_mux: probed
 [    1.124869] dwmac-sun8i 1c30000.ethernet: Switch mux to internal PHY
 [    1.131286] dwmac-sun8i 1c30000.ethernet: Powering internal PHY
 [    1.139085] ehci_hcd: USB 2.0 &#39;Enhanced&#39; Host Controller (EHCI) Driver
 [    1.145759] ehci-platform: EHCI generic platform driver
 [    1.151239] ohci_hcd: USB 1.1 &#39;Open&#39; Host Controller (OHCI) Driver
 [    1.157465] ohci-platform: OHCI generic platform driver
 [    1.164161] input: 1c22800.lradc as /devices/platform/soc/1c22800.lradc/input/input0
 [    1.173440] rotary-encoder rotary@0: gray
 [    1.178460] input: rotary@0 as /devices/platform/rotary@0/input/input1
 [    1.187134] sun6i-rtc 1c20400.rtc: registered as rtc0
 [    1.192416] sun6i-rtc 1c20400.rtc: setting system clock to 1970-01-01T01:26:51 UTC (5211)
 [    1.200591] sun6i-rtc 1c20400.rtc: RTC enabled
 [    1.205482] i2c /dev entries driver
 [    1.210476] input: ns2009_ts as /devices/platform/soc/1c2ac00.i2c/i2c-0/0-0048/input/input2
 [    1.220426] Driver for 1-wire Dallas network protocol.
 [    1.227208] sunxi-wdt 1c20ca0.watchdog: Watchdog enabled (timeout=16 sec, nowayout=0)
 [    1.235342] Bluetooth: HCI UART driver ver 2.3
 [    1.239793] Bluetooth: HCI UART protocol H4 registered
 [    1.245041] Bluetooth: HCI UART protocol Three-wire (H5) registered
 [    1.252426] sun8i-v3s-pinctrl 1c20800.pinctrl: supply vcc-pf not found, using dummy regulator
 [    1.263407] sun8i-v3s-pinctrl 1c20800.pinctrl: supply vcc-pg not found, using dummy regulator
 [    1.274623] ledtrig-cpu: registered to indicate activity on CPUs
 [    1.281222] sun4i-ss 1c15000.crypto: Die ID 7
 [    1.288761] usbcore: registered new interface driver usbhid
 [    1.294484] usbhid: USB HID core driver
 [    1.299370] sunxi-mmc 1c0f000.mmc: initialized, max. request size: 16384 KB
 [    1.306740] sunxi-mmc 1c10000.mmc: initialized, max. request size: 16384 KB
 [    1.316119] sun4i-codec 1c22c00.codec: Failed to register our card
 [    1.324501] NET: Registered protocol family 17
 [    1.328998] can: controller area network core
 [    1.333627] NET: Registered protocol family 29
 [    1.338086] can: raw protocol
 [    1.341133] can: broadcast manager protocol
 [    1.345329] can: netlink gateway - max_hops=1
 [    1.350297] Bluetooth: RFCOMM TTY layer initialized
 [    1.355353] Bluetooth: RFCOMM socket layer initialized
 [    1.360538] Bluetooth: RFCOMM ver 1.11
 [    1.364363] Bluetooth: BNEP (Ethernet Emulation) ver 1.3
 [    1.369672] Bluetooth: BNEP filters: protocol multicast
 [    1.374928] Bluetooth: BNEP socket layer initialized
 [    1.379890] Bluetooth: HIDP (Human Interface Emulation) ver 1.2
 [    1.385825] Bluetooth: HIDP socket layer initialized
 [    1.391148] Key type dns_resolver registered
 [    1.395595] Registering SWP/SWPB emulation handler
 [    1.400448] Loading compiled-in X.509 certificates
 [    1.437437] sun4i-drm display-engine: bound 1100000.mixer (ops 0xc097c610)
 [    1.445077] sun4i-drm display-engine: bound 1c0c000.lcd-controller (ops 0xc097891c)
 [    1.453961] [drm] Initialized sun4i-drm 1.0.0 20150629 for display-engine on minor 0
 [    1.465480] sunxi-mmc 1c10000.mmc: card claims to support voltages below defined range
 [    1.475874] mmc1: new high speed SDIO card at address 0001
 [    1.493616] mmc0: host does not support reading read-only switch, assuming write-enable
 [    1.495706] mmc0: new high speed SDHC card at address 0002
 [    1.496918] mmcblk0: mmc0:0002 MSD20 3.73 GiB 
 [    1.499651]  mmcblk0: p1 p2 p3
 [    1.507412] Console: switching to colour frame buffer device 100x30
 [    1.566756] sun4i-drm display-engine: [drm] fb0: sun4i-drmdrmfb frame buffer device
 [    1.576864] debugfs: Directory &#39;1c22c00.codec&#39; with parent &#39;V3s Audio Codec&#39; already present!
 [    1.591054] ALSA device list:
 [    1.594055]   #0: V3s Audio Codec
 [    1.612781] EXT4-fs (mmcblk0p2): mounted filesystem with ordered data mode. Opts: (null)
 [    1.621158] VFS: Mounted root (ext4 filesystem) on device 179:2.
 [    1.629553] devtmpfs: mounted
 [    1.633946] Freeing unused kernel memory: 1024K
 [    1.638711] Run /sbin/init as init process
 [    1.690069] random: fast init done
 [    1.792914] EXT4-fs (mmcblk0p2): re-mounted. Opts: (null)
 Starting syslogd: OK
 Starting klogd: OK
 Running sysctl: OK
 Starting mdev... OK
 [    3.206544] cfg80211: Loading compiled-in X.509 certificates for regulatory database
 [    3.248879] cfg80211: Loaded X.509 cert &#39;sforshee: 00b28ddf47aef9cea7&#39;
 [    3.258062] platform regulatory.0: Direct firmware load for regulatory.db failed with error -2
 [    3.266896] cfg80211: failed to load regulatory.db
 [    3.359658] 8723ds: module is from the staging directory, the quality is unknown, you have been warned.
 Initializing random number generator: OK
 Saving random seed: [    3.742299] random: dd: uninitialized urandom read (512 bytes read)
 OK
 Starting system message bus: [    3.812938] random: dbus-uuidgen: uninitialized urandom read (12 bytes read)
 [    3.820155] random: dbus-uuidgen: uninitialized urandom read (8 bytes read)
 done
 Starting bluetoothd: OK
 Starting network: OK
 [    6.200965] random: crng init done
 [    6.204396] random: 3 urandom warning(s) missed due to ratelimiting
 Starting sshd: OK
 Welcome to Buildroot for the LicheePi Zero
 licheepi-zero login: </code></pre>
</li>
<li><p>UART2默认速率是9600可以使用cat /dev/ttyS2来测试串口是否正常</p>
</li>
<li><p>使用rtk_hciattach绑定uart端口</p>
<pre><code> rtk_hciattach -n -s 115200/dev/ttyS2 rtk_h5 &amp;</code></pre>
<p><code>注意这个过程需要加载固件才行，如果固件不存在、不匹配或者错误就会失败。需要把固件放到提示的位置</code></p>
</li>
<li><p>固件及配置文件加载完后 </p>
<pre><code> Realtek Bluetooth :Init Process finished 
 Realtek Bluetooth post process 
 Device setup complete </code></pre>
<p><code>出现这个说明蓝牙模块初始化完成 此时hci0蓝牙端口已经生成,使用hciconfig工具可以查看端口及状态</code></p>
</li>
<li><p>hciconfig -a </p>
<pre><code> hci0:   Type: Primary  Bus: UART 
     BD Address: 34:20:03:AA:A3:7E  ACL MTU: 1021:8  SCO MTU: 255:12 
     UP RUNNING PSCAN ISCAN 
     RX bytes:165747 acl:159 sco:0 events:1160 errors:0 
     TX bytes:16622 acl:158 sco:0 commands:225 errors:0 
     Features: 0xff 0xff 0xff 0xfe 0xdb 0xfd 0x7b 0x87 
     Packet type: DM1 DM3 DM5 DH1 DH3 DH5 HV1 HV2 HV3 
     Link policy: RSWITCH HOLD SNIFF PARK 
     Link mode: SLAVE ACCEPT 
     Name: &#39;Sonavox-BT&#39; 
     Class: 0x040428 
     Service Classes: Rendering 
     Device Class: Audio/Video, HiFi Audio Device 
     HCI Version: 4.1 (0x7)  Revision: 0xaa7a 
     LMP Version: 4.1 (0x7)  Subversion: 0x8cb2 
     Manufacturer: Realtek Semiconductor Corporation (93) </code></pre>
</li>
<li><p>bluealsa -p a2dp-sink &amp;<br> <code>建立bluez与alsa之前的桥梁，否则无法播放音频，只能连接上</code></p>
</li>
<li><p>bluetoothd启动需要加载一些配置文件在/etc/bluetooth/main.conf 不加载也可以 </p>
<pre><code> #Default adaper name
 #Defaults to &#39;BlueZ X.YZ&#39;
 Name = Sonavox-BT

 #Default device class. Only the major and minor device class bits are
 #considered. Defaults to &#39;0x000000&#39;.
 Class = 0x000428

 #How long to stay in discoverable mode before going back to non-discoverable
 #The value is in seconds. Default is 180, i.e. 3 minutes.
 #0 = disable timer, i.e. stay discoverable forever
 DiscoverableTimeout = 0

 #How long to stay in pairable mode before going back to non-discoverable
 #The value is in seconds. Default is 0.
 #0 = disable timer, i.e. stay pairable forever
 PairableTimeout = 0

 #Automatic connection for bonded devices driven by platform/user events.
 #If a platform plugin uses this mechanism, automatic connections will be
 #enabled during the interval defined below. Initially, this feature
 #intends to be used to establish connections to ATT channels. Default is 60.
 AutoConnectTimeout = 60</code></pre>
</li>
<li><p>使用蓝牙界的瑞士军刀bluetoothctl来调试蓝牙</p>
</li>
<li><p>下面是可用的命令</p>
<pre><code>Available commands:
-------------------
advertise                                         Advertise Options Submenu
scan                                              Scan Options Submenu
gatt                                              Generic Attribute Submenu
list                                              List available controllers
show [ctrl]                                       Controller information
select &lt;ctrl&gt;                                     Select default controller
devices                                           List available devices
paired-devices                                    List paired devices
system-alias &lt;name&gt;                               Set controller alias
reset-alias                                       Reset controller alias
power &lt;on/off&gt;                                    Set controller power
pairable &lt;on/off&gt;                                 Set controller pairable mode
discoverable &lt;on/off&gt;                             Set controller discoverable mode
discoverable-timeout [value]                      Set discoverable timeout
agent &lt;on/off/capability&gt;                         Enable/disable agent with given capability
default-agent                                     Set agent as the default one
advertise &lt;on/off/type&gt;                           Enable/disable advertising with given type
set-alias &lt;alias&gt;                                 Set device alias
scan &lt;on/off&gt;                                     Scan for devices
info [dev]                                        Device information
pair [dev]                                        Pair with device
cancel-pairing [dev]                              Cancel pairing with device
trust [dev]                                       Trust device
untrust [dev]                                     Untrust device
block [dev]                                       Block device
unblock [dev]                                     Unblock device
remove &lt;dev&gt;                                      Remove device
connect &lt;dev&gt;                                     Connect device
disconnect [dev]                                  Disconnect device
menu &lt;name&gt;                                       Select submenu
version                                           Display version
quit                                              Quit program
exit                                              Quit program
help                                              Display help about this program
export                                            Print environment variables</code></pre>
</li>
<li><p>操作记录如下: trust dev 之后，再连接就不再提示密码了，直接连接上</p>
<pre><code>[bluetooth]# discoverable on
Changing discoverable on succeeded
[bluetooth]# pairable on
Changing pairable on succeeded
[CHG] Device D8:8F:76:51:A7:87 Connected: yes
Request confirmation
[agent] Confirm passkey 151930 (yes/no): yes
Authorize service
[agent] Authorize service 0000110d-0000-1000-8000-00805f9b34fb (yes/no):
[CHG] Device D8:8F:76:51:A7:87 ServicesResolved: yes
[agent] Authorize service 0000110d-0000-1000-8000-00805f9b34fb (yes/no): yes
Authorize service
[agent] Authorize service 0000110e-0000-1000-8000-00805f9b34fb (yes/no): yes
[ 2681.328397] input: iPhone (AVRCP) as /devices/virtual/input/#input5
[iPhone]# list
Controller 34:20:03:AA:A3:7E Sonavox-BT [default]
[iPhone]# devices
Device D8:8F:76:51:A7:87 iPhone
[iPhone]# info
Device D8:8F:76:51:A7:87 (public)
        Name: iPhone
        Alias: iPhone
        Class: 0x007a020c
        Icon: phone
        Paired: yes
        Trusted: no
        Blocked: no
        Connected: yes
        LegacyPairing: no
        UUID: Vendor specific           (00000000-deca-fade-deca-deafdecacafe)
        UUID: Service Discovery Serve.. (00001000-0000-1000-8000-00805f9b34fb)
        UUID: Audio Source              (0000110a-0000-1000-8000-00805f9b34fb)
        UUID: A/V Remote Control Target (0000110c-0000-1000-8000-00805f9b34fb)
        UUID: Advanced Audio Distribu.. (0000110d-0000-1000-8000-00805f9b34fb)
        UUID: A/V Remote Control        (0000110e-0000-1000-8000-00805f9b34fb)
        UUID: NAP                       (00001116-0000-1000-8000-00805f9b34fb)
        UUID: Handsfree Audio Gateway   (0000111f-0000-1000-8000-00805f9b34fb)
        UUID: Phonebook Access Server   (0000112f-0000-1000-8000-00805f9b34fb)
        UUID: Message Access Server     (00001132-0000-1000-8000-00805f9b34fb)
        UUID: PnP Information           (00001200-0000-1000-8000-00805f9b34fb)
        UUID: Generic Access Profile    (00001800-0000-1000-8000-00805f9b34fb)
        UUID: Generic Attribute Profile (00001801-0000-1000-8000-00805f9b34fb)
        UUID: Current Time Service      (00001805-0000-1000-8000-00805f9b34fb)
        UUID: Device Information        (0000180a-0000-1000-8000-00805f9b34fb)
        UUID: Battery Service           (0000180f-0000-1000-8000-00805f9b34fb)
        UUID: Vendor specific           (02030302-1d19-415f-86f2-22a2106a0a77)
        UUID: Vendor specific           (7905f431-b5ce-4e99-a40f-4b1e122d00d0)
        UUID: Vendor specific           (89d3502b-0f36-433a-8ef4-c502ad55f8dc)
        UUID: Vendor specific           (9fa480e0-4967-4542-9390-d343dc5d04ae)
        UUID: Vendor specific           (d0611e78-bbb4-4591-a5f8-487910ae4366)
        Modalias: bluetooth:v004Cp710Cd0E70
        Battery Percentage: 0x55 (85)
[iPhone]# quit

# cat /proc/bus/input/devices
I: Bus=0019 Vendor=0001 Product=0001 Version=0100
N: Name=&quot;1c22800.lradc&quot;
P: Phys=sun4i_lradc/input0
S: Sysfs=/devices/platform/soc/1c22800.lradc/input/input0
U: Uniq=
H: Handlers=kbd event0 
B: PROP=0
B: EV=3
B: KEY=3 0 0 0 0 0 0 0 c0000 0 0 0

I: Bus=0019 Vendor=0000 Product=0000 Version=0000
N: Name=&quot;rotary@0&quot;
P: Phys=
S: Sysfs=/devices/platform/rotary@0/input/input1
U: Uniq=
H: Handlers=event1 
B: PROP=0
B: EV=5
B: REL=1

I: Bus=0018 Vendor=0000 Product=0000 Version=0000
N: Name=&quot;ns2009_ts&quot;
P: Phys=input/ts
S: Sysfs=/devices/platform/soc/1c2ac00.i2c/i2c-0/0-0048/input/input2
U: Uniq=
H: Handlers=event2 
B: PROP=0
B: EV=b
B: KEY=400 0 0 0 0 0 0 0 0 0 0
B: ABS=3

I: Bus=0005 Vendor=004c Product=710c Version=0e70
N: Name=&quot;iPhone (AVRCP)&quot;
P: Phys=34:20:03:aa:a3:7e
S: Sysfs=/devices/virtual/input/input5
U: Uniq=
H: Handlers=kbd event3 
B: PROP=0
B: EV=100007
B: KEY=2fc800 1452 0 0 0 0 10300 49e8 c00 e1680 f f8100000 10000ffc
B: REL=0</code></pre>
</li>
<li><p>通过AVRCP来控制手机上一曲，下一曲等 <a href="https://git.kernel.org/pub/scm/bluetooth/bluez.git/tree/doc/media-api.txt">https://git.kernel.org/pub/scm/bluetooth/bluez.git/tree/doc/media-api.txt</a><br><code>注意这里的蓝牙地址是你手机的，不是蓝牙模块的，因为要控制的是你的手机进行一一曲，下一曲的，地址不对会提示错误，就是这个原因</code></p>
<pre><code>Error org.freedesktop.DBus.Error.UnknownObject: Method &quot;Previous&quot; with signature &quot;&quot; on interface &quot;org.bluez.MediaControl1&quot; doesn&#39;t exist 

# dbus-send --system --print-reply --dest=org.bluez /org/bluez/hci0/dev_D8_8F_76_51_A7_87 org.bluez.MediaControl1.Pause
# dbus-send --system --print-reply --dest=org.bluez /org/bluez/hci0/dev_D8_8F_76_51_A7_87 org.bluez.MediaControl1.Play
# dbus-send --system --print-reply --dest=org.bluez /org/bluez/hci0/dev_D8_8F_76_51_A7_87 org.bluez.MediaControl1.Previous
# dbus-send --system --print-reply --dest=org.bluez /org/bluez/hci0/dev_D8_8F_76_51_A7_87 org.bluez.MediaControl1.Next
# dbus-send --system --print-reply --dest=org.bluez /org/bluez/hci0/dev_D8_8F_76_51_A7_87 org.bluez.MediaControl1.VolumeUp
# dbus-send --system --print-reply --dest=org.bluez /org/bluez/hci0/dev_D8_8F_76_51_A7_87 org.bluez.MediaControl1.VolumeDown
以下返回结果，可以看到&quot;org.bluez.MediaControl1&quot;已经注册了，但是提示已废弃，新的方法是&quot;org.bluez.MediaPlay1&quot;,但是我这里用不了
&lt;node&gt;
    &lt;interface name=&quot;org.freedesktop.DBus.Introspectable&quot;&gt;
        &lt;method name=&quot;Introspect&quot;&gt;
            &lt;arg name=&quot;xml&quot; type=&quot;s&quot; direction=&quot;out&quot;/&gt;
        &lt;/method&gt;
    &lt;/interface&gt;
    &lt;interface name=&quot;org.bluez.Device1&quot;&gt;
        &lt;method name=&quot;Disconnect&quot;&gt;&lt;/method&gt;
        &lt;method name=&quot;Connect&quot;&gt;&lt;/method&gt;
        &lt;method name=&quot;ConnectProfile&quot;&gt;
            &lt;arg name=&quot;UUID&quot; type=&quot;s&quot; direction=&quot;in&quot;/&gt;
        &lt;/method&gt;
        &lt;method name=&quot;DisconnectProfile&quot;&gt;
            &lt;arg name=&quot;UUID&quot; type=&quot;s&quot; direction=&quot;in&quot;/&gt;
        &lt;/method&gt;
        &lt;method name=&quot;Pair&quot;&gt;&lt;/method&gt;
        &lt;method name=&quot;CancelPairing&quot;&gt;&lt;/method&gt;
        &lt;property name=&quot;Address&quot; type=&quot;s&quot; access=&quot;read&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;AddressType&quot; type=&quot;s&quot; access=&quot;read&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;Name&quot; type=&quot;s&quot; access=&quot;read&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;Alias&quot; type=&quot;s&quot; access=&quot;readwrite&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;Class&quot; type=&quot;u&quot; access=&quot;read&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;Appearance&quot; type=&quot;q&quot; access=&quot;read&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;Icon&quot; type=&quot;s&quot; access=&quot;read&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;Paired&quot; type=&quot;b&quot; access=&quot;read&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;Trusted&quot; type=&quot;b&quot; access=&quot;readwrite&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;Blocked&quot; type=&quot;b&quot; access=&quot;readwrite&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;LegacyPairing&quot; type=&quot;b&quot; access=&quot;read&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;RSSI&quot; type=&quot;n&quot; access=&quot;read&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;Connected&quot; type=&quot;b&quot; access=&quot;read&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;UUIDs&quot; type=&quot;as&quot; access=&quot;read&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;Modalias&quot; type=&quot;s&quot; access=&quot;read&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;Adapter&quot; type=&quot;o&quot; access=&quot;read&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;ManufacturerData&quot; type=&quot;a&#123;qv&#125;&quot; access=&quot;read&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;ServiceData&quot; type=&quot;a&#123;sv&#125;&quot; access=&quot;read&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;TxPower&quot; type=&quot;n&quot; access=&quot;read&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;ServicesResolved&quot; type=&quot;b&quot; access=&quot;read&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;WakeAllowed&quot; type=&quot;b&quot; access=&quot;readwrite&quot;&gt;&lt;/property&gt;
    &lt;/interface&gt;
    &lt;interface name=&quot;org.freedesktop.DBus.Properties&quot;&gt;
        &lt;method name=&quot;Get&quot;&gt;
            &lt;arg name=&quot;interface&quot; type=&quot;s&quot; direction=&quot;in&quot;/&gt;
            &lt;arg name=&quot;name&quot; type=&quot;s&quot; direction=&quot;in&quot;/&gt;
            &lt;arg name=&quot;value&quot; type=&quot;v&quot; direction=&quot;out&quot;/&gt;
        &lt;/method&gt;
        &lt;method name=&quot;Set&quot;&gt;
            &lt;arg name=&quot;interface&quot; type=&quot;s&quot; direction=&quot;in&quot;/&gt;
            &lt;arg name=&quot;name&quot; type=&quot;s&quot; direction=&quot;in&quot;/&gt;
            &lt;arg name=&quot;value&quot; type=&quot;v&quot; direction=&quot;in&quot;/&gt;
        &lt;/method&gt;
        &lt;method name=&quot;GetAll&quot;&gt;
            &lt;arg name=&quot;interface&quot; type=&quot;s&quot; direction=&quot;in&quot;/&gt;
            &lt;arg name=&quot;properties&quot; type=&quot;a&#123;sv&#125;&quot; direction=&quot;out&quot;/&gt;
        &lt;/method&gt;
        &lt;signal name=&quot;PropertiesChanged&quot;&gt;
            &lt;arg name=&quot;interface&quot; type=&quot;s&quot;/&gt;
            &lt;arg name=&quot;changed_properties&quot; type=&quot;a&#123;sv&#125;&quot;/&gt;
            &lt;arg name=&quot;invalidated_properties&quot; type=&quot;as&quot;/&gt;
        &lt;/signal&gt;
    &lt;/interface&gt;
    &lt;interface name=&quot;org.bluez.Network1&quot;&gt;
        &lt;method name=&quot;Connect&quot;&gt;
            &lt;arg name=&quot;uuid&quot; type=&quot;s&quot; direction=&quot;in&quot;/&gt;
            &lt;arg name=&quot;interface&quot; type=&quot;s&quot; direction=&quot;out&quot;/&gt;
        &lt;/method&gt;
        &lt;method name=&quot;Disconnect&quot;&gt;&lt;/method&gt;
        &lt;property name=&quot;Connected&quot; type=&quot;b&quot; access=&quot;read&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;Interface&quot; type=&quot;s&quot; access=&quot;read&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;UUID&quot; type=&quot;s&quot; access=&quot;read&quot;&gt;&lt;/property&gt;
    &lt;/interface&gt;
    &lt;interface name=&quot;org.bluez.MediaControl1&quot;&gt;
        &lt;method name=&quot;Play&quot;&gt;
            &lt;annotation name=&quot;org.freedesktop.DBus.Deprecated&quot; value=&quot;true&quot;/&gt;
        &lt;/method&gt;
        &lt;method name=&quot;Pause&quot;&gt;
            &lt;annotation name=&quot;org.freedesktop.DBus.Deprecated&quot; value=&quot;true&quot;/&gt;
        &lt;/method&gt;
        &lt;method name=&quot;Stop&quot;&gt;
            &lt;annotation name=&quot;org.freedesktop.DBus.Deprecated&quot; value=&quot;true&quot;/&gt;
        &lt;/method&gt;
        &lt;method name=&quot;Next&quot;&gt;
            &lt;annotation name=&quot;org.freedesktop.DBus.Deprecated&quot; value=&quot;true&quot;/&gt;
        &lt;/method&gt;
        &lt;method name=&quot;Previous&quot;&gt;
            &lt;annotation name=&quot;org.freedesktop.DBus.Deprecated&quot; value=&quot;true&quot;/&gt;
        &lt;/method&gt;
        &lt;method name=&quot;VolumeUp&quot;&gt;
            &lt;annotation name=&quot;org.freedesktop.DBus.Deprecated&quot; value=&quot;true&quot;/&gt;
        &lt;/method&gt;
        &lt;method name=&quot;VolumeDown&quot;&gt;
            &lt;annotation name=&quot;org.freedesktop.DBus.Deprecated&quot; value=&quot;true&quot;/&gt;
        &lt;/method&gt;
        &lt;method name=&quot;FastForward&quot;&gt;
            &lt;annotation name=&quot;org.freedesktop.DBus.Deprecated&quot; value=&quot;true&quot;/&gt;
        &lt;/method&gt;
        &lt;method name=&quot;Rewind&quot;&gt;
            &lt;annotation name=&quot;org.freedesktop.DBus.Deprecated&quot; value=&quot;true&quot;/&gt;
        &lt;/method&gt;
        &lt;property name=&quot;Connected&quot; type=&quot;b&quot; access=&quot;read&quot;&gt;&lt;/property&gt;
        &lt;property name=&quot;Player&quot; type=&quot;o&quot; access=&quot;read&quot;&gt;&lt;/property&gt;
    &lt;/interface&gt;
    &lt;interface name=&quot;org.bluez.Battery1&quot;&gt;
        &lt;property name=&quot;Percentage&quot; type=&quot;y&quot; access=&quot;read&quot;&gt;&lt;/property&gt;
    &lt;/interface&gt;
    &lt;node name=&quot;fd1&quot;/&gt;
    &lt;node name=&quot;player2&quot;/&gt;
    &lt;node name=&quot;sep1&quot;/&gt;
    &lt;node name=&quot;sep2&quot;/&gt;
    &lt;node name=&quot;sep3&quot;/&gt;
    &lt;node name=&quot;sep4&quot;/&gt;
    &lt;node name=&quot;sep5&quot;/&gt;
    &lt;node name=&quot;sep6&quot;/&gt;
    &lt;node name=&quot;service0006&quot;/&gt;
    &lt;node name=&quot;service000a&quot;/&gt;
    &lt;node name=&quot;service000f&quot;/&gt;
    &lt;node name=&quot;service0014&quot;/&gt;
    &lt;node name=&quot;service0018&quot;/&gt;
    &lt;node name=&quot;service001e&quot;/&gt;
    &lt;node name=&quot;service0023&quot;/&gt;
    &lt;node name=&quot;service002d&quot;/&gt;
&lt;/node&gt;&quot;</code></pre>
</li>
<li><p>另外在蓝牙连接成功时会在/dev/input/目录下注册一个event3</p>
<pre><code>I: Bus=0005 Vendor=004c Product=710c Version=0e70
N: Name=&quot;iPhone (AVRCP)&quot;
P: Phys=34:20:03:aa:a3:7e
S: Sysfs=/devices/virtual/input/input5
U: Uniq=
H: Handlers=kbd event3 
B: PROP=0
B: EV=100007
B: KEY=2fc800 1452 0 0 0 0 10300 49e8 c00 e1680 f f8100000 10000ffc
B: REL=0</code></pre>
<p>我偿试过使用sendevent 去操作/dev/input/event3 但是没有任何反应，不知道能不能这样操作？</p>
<pre><code># ./sendevent /dev/input/event3 1 116 1
# ./sendevent /dev/input/event3 0 0 0
# ./sendevent /dev/input/event3 1 114 1</code></pre>
</li>
<li><p>至此，蓝牙 DLNA，Airplay可以同时播放音乐了</p>
</li>
</ol>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>V3S</tag>
        <tag>BT</tag>
        <tag>Audio</tag>
      </tags>
  </entry>
  <entry>
    <title>在V3S上使用红外接收头</title>
    <url>/2021/08/23/Linux/%E5%9C%A8Linux%E4%B8%8A%E4%BD%BF%E7%94%A8%E7%BA%A2%E5%A4%96%E9%81%A5%E6%8E%A7/</url>
    <content><![CDATA[<ol>
<li><p>确定要使用的GPIO,这里需要使用带外部中断的引脚,否则驱动注册失败 request:-22 </p>
<p> 这是我的设备树配置</p>
<pre><code> ir_gpio &#123;
 compatible  = &quot;gpio-ir-receiver&quot;;
 gpios = &lt;&amp;pio 1 5 GPIO_ACTIVE_LOW&gt;; /* PB5 */
 /*active_low = &lt;1&gt;;*/
 linux,rc-map-name = &quot;rc-tevii-nec&quot;;
 status = &quot;okay&quot;;</code></pre>
<p> };</p>
</li>
<li><p>内核里修改 </p>
<blockquote>
<p>Device Drivers &gt; Remote Controller support &gt;</p>
<pre><code> [*]   LIRC user interface                                             
 [*]   Remote controller decoders  ---&gt;                                
 [*]   Remote Controller devices  ---&gt;                                 
       &lt;*&gt;   GPIO IR remote control </code></pre>
</blockquote>
</li>
</ol>
<ol start="3">
<li><p>驱动成功加载会有如下输出</p>
<p> [    1.223257] IR NEC protocol handler initialized<br> [    1.227806] IR RC5(x/sz) protocol handler initialized<br> [    1.232985] IR RC6 protocol handler initialized<br> [    1.237517] IR JVC protocol handler initialized<br> [    1.242080] IR Sony protocol handler initialized<br> [    1.246693] IR SANYO protocol handler initialized<br> [    1.251406] IR Sharp protocol handler initialized<br> [    1.256104] IR RCMM protocol handler initialized<br> [    1.261050] Registered IR keymap rc-tevii-nec<br> [    1.265477] rc rc0: gpio_ir_recv as /devices/platform/ir_gpio/rc/rc0<br> [    1.272194] rc rc0: lirc_dev: driver gpio_ir_recv registered at minor = 0, raw IR receiver, no transmitter<br> [    1.282144] input: gpio_ir_recv as /devices/platform/ir_gpio/rc/rc0/input3</p>
</li>
<li><p>此时查看/dev/input目录下,会有如下显示：</p>
<pre><code> # evtest 
 No device specified, trying to scan all of /dev/input/event*
 Available devices:
 /dev/input/event0:      1c22800.lradc
 /dev/input/event1:      rotary@0
 /dev/input/event2:      ns2009_ts
 /dev/input/event3:      gpio_ir_recv</code></pre>
<p> 此时如果用evtest测试按键是没有任何反应的，拿示波器测试信号是正常的<br> 没有问题，可就是evtest 没有任何反应,需要修改对应的驱动，此问题先留在这里<br> 不影响后续操作</p>
</li>
<li><p>后来查资料，发现可以用lirc里的工具去测试硬件是否OK,测试之前要先修改默认配置文件，不修改的话，同样没反应</p>
<pre><code> # vi /etc/lirc/lirc_options.conf 
 driver          = default
 device          = /dev/lric0
 修改这2行就可以，里边driver默认是uinput,device默认是auto
 再次测试就有反应了
 # mode2 -m -d /dev/lirc0
 Using driver default on device /dev/lirc0
 Trying device: /dev/lirc0
 Using device: /dev/lirc0
 Warning: Running as root.
    9043     4402      626      497      656      499
     624      499      656      499      624      499
     656      499      624      499      624      531
     624     1630      619     1624      655     1624
     624     1624      624     1634      646     1624
     624     1624      655     1624      593     1656
     624      501      654     1624      593      534
     652     1624      624      499      625     1624
     656      504      619      499      655     1625
     624      499      656     1625      593      531
     624     1633      648      498      624     1624
     624    40035  
    9060     2184      624   143451-pulse   483450-space</code></pre>
<p> 从这结果上可以明显的看出这些数值代表脉冲宽度，单位是us </p>
</li>
<li><p>使用irrecod -f -d /dev/lirc0 –disable-namespace来录制配置文件<br> 录制完成后放到 /etc/lric/liricd.conf.d/下边<br> !注意，这里录制的结果不准确，需要借助上边的命令来获取每一个按键的值,这里只是借用一下配置文件的格式,里边的数字是右对齐<br> 示例：</p>
<pre><code> # Please take the time to finish this file as described in
 # https://sourceforge.net/p/lirc-remotes/wiki/Checklist/
 # and make it available to others by sending it to
 # &lt;lirc@bartelmus.de&gt;
 #
 # This config file was automatically generated
 # using lirc-0.10.1(default) on Thu Jan  1 01:37:06 1970
 # Command line used: -f -d /dev/lirc0 --disable-namespace
 # Kernel version (uname -r): 5.10.19
 #
 # Remote name (as of config file): elac
 # Brand of remote device, the thing you hold in your hand:
 # Remote device model nr:
 # Remote device info url:
 # Does remote device has a bundled capture device e. g., a
 #     usb dongle? :
 # For bundled USB devices: usb vendor id, product id
 #     and device string (use dmesg or lsusb):
 # Type of device controlled
 #     (TV, VCR, Audio, DVD, Satellite, Cable, HTPC, ...) :
 # Device(s) controlled by this remote:

 begin remote

 name  elac
 flags RAW_CODES|CONST_LENGTH
 eps            30
 aeps          100

 gap          108533

     begin raw_codes

         name Power
        9043     4403      623      531      593      531
         624      531      593      531      624      531
         593      531      624      531      593      536
         594     1680      592     1656      593     1656
         625     1655      593     1666      582     1656
         624     1656      593     1655      625      530
         593      534      621      530      593     1656
         624     1624      624      531      593      530
         624      531      595     1655      623     1655
         593     1656      593      530      624      531
         593     1664      616     1656      593     1656
         593

         name BT
        9041     4407      622      531      593      531
         593      562      593      531      593      531
         625      533      596      525      624      530
         593     1656      624     1656      593     1655
         593     1664      616     1655      593     1656
         593     1656      624     1658      591      530
         624     1656      593      531      624      531
         593      531      593      531      624     1661
         587      530      624     1656      593      531
         593     1687      593     1656      601     1648
         624     1656      593      531      593     1656
         624

     name Vol+
        9013     4437      592      530      593      562
         593      531      624      531      593      531
         594      565      589      530      593      531
         624     1656      593     1656      624     1665
         590     1651      591     1656      624     1655
         593     1656      593     1667      613      531
         593     1656      624     1656      593      531
         593      562      595      528      593     1656
         624      531      593     1656      624      531
         593      530      593     1659      621     1655
         593     1656      593      562      593     1656
         593

     name Vol-
        9044     4436      592      531      624      531
         593      533      622      530      593      531
         593      531      624      531      593      530
         624     1656      593     1661      595     1679
         593     1655      593     1656      624     1656
         593     1667      582     1659      620      530
         593     1656      624     1656      600      524
         624     1656      593      531      593      531
         624      531      593     1656      624      531
         598      530      620     1654      593      531
         624     1625      624     1656      593     1666
         614

     name Pre
        9048     4403      592      562      593      530
         593      562      593      530      593      531
         624      531      593      531      624      531
         593     1661      593     1680      592     1656
         593     1656      624     1656      603     1650
         588     1656      623     1656      593     1656
         624     1662      587     1655      593      531
         624      531      593      531      624     1656
         593      531      631      524      593      530
         593      562      593     1656      593     1656
         624     1663      586      530      624     1624
         624

     name Next
        9022     4425      593      530      624      531
         593      531      624      531      597      527
         623      531      593      531      593      562
         593     1656      593     1656      624     1663
         585     1655      624     1656      593     1656
         593     1656      633     1646      593     1656
         593      562      593     1656      593      530
         624     1658      591      531      593      562
         593      531      624      531      593     1656
         624      499      624     1659      591      530
         624     1656      593     1656      593     1687
         601

     name Play
        9027     4431      592      531      624      531
         593      531      624      531      593      531
         593      562      593      531      624      531
         598     1652      592     1655      624     1656
         593     1656      624     1633      616     1656
         593     1656      624     1624      624     1656
         595      529      624     1656      593      531
         593     1687      593      531      593     1665
         620      526      592      530      624     1656
         593      531      594     1655      624      531
         593     1665      615      531      593     1656
         624

     name Ana1
        9044     4408      621      530      593      530
         624      531      593      531      593      562
         593      531      593      562      593      531
         593     1655      624     1656      593     1655
         597     1654      621     1655      593     1655
         624     1624      624     1665      584      530
         625      530      593     1656      593      562
         593      531      624      499      624      531
         599      525      624     1655      593     1656
         593      562      593     1656      593     1659
         621     1655      593     1656      593     1656
         624

     name Ana2
        9040     4402      656      500      624      499
         656      499      624      499      624      531
         624      499      624      531      624      499
         624     1632      655     1628      589     1650
         593     1655      624     1655      593     1670
         610     1656      593     1656      593      531
         624     1656      596     1655      590      562
         593      531      624      500      624      531
         593      531      624     1656      599      529
         620      530      593     1656      624     1625
         624     1656      593     1662      619     1656
         593

     name Opt1
        9016     4435      624      530      593      531
         624      533      591      531      624      531
         593      531      593      562      593      531
         593     1656      624     1685      564     1655
         624     1624      624     1656      593     1656
         637     1643      593     1656      593      531
         624      531      593     1656      624      531
         596     1653      624      531      593      531
         593      562      593     1656      593     1656
         630      526      591     1656      624      531
         593     1656      593     1656      624     1664
         585

     name Opt2
        9043     4403      655      499      624      499
         656      499      627      497      656      499
         624      499      625      530      624      502
         628     1618      655     1654      601     1619
         623     1624      656     1624      624     1624
         656     1636      613     1625      624      499
         656      499      624      499      656      499
         624     1626      622      531      624      499
         624      531      624     1624      624     1624
         624     1662      618     1624      624      499
         656     1624      624     1624      624     1665
         615

     name Coax
        9015     4439      591      531      624      531
         593      530      624      531      593      531
         593      562      593      531      593      531
         624     1656      593     1656      624     1656
         611     1642      589     1655      624     1656
         593     1656      593     1668      613     1655
         593     1656      593     1656      624      531
         593     1658      622      531      593      530
         593      562      593      531      624      531
         656      468      593     1656      630      525
         592     1655      593     1687      593     1656
         593
     name USB
        9050     4433      593      531      594      561
         593      531      593      531      624      531
         593      531      624      530      593      531
         624     1656      603     1645      593     1656
         624     1656      593     1655      624     1659
         590     1655      593     1656      624      531
         593      531      624      531      593      537
         618      530      593      531      624     1656
         593      531      624     1624      624     1662
         587     1655      624     1655      593     1656
         593     1656      632      523      593     1656
         624

     end raw_codes

 end remote</code></pre>
</li>
<li><p>接下来使用irw来验证刚才录制的是否正确</p>
<pre><code> # irw
 lircd-0.10.1[432]: Notice: accepted new client on /var/run/lirc/lircd
 lircd-0.10.1[432]: Info: [lirc] protocol is enabled
 0000000000000001 00 Power elac
 0000000000000002 00 BT elac
 0000000000000003 00 Vol+ elac
 0000000000000004 00 Vol- elac
 0000000000000008 00 Ana1 elac
 000000000000000a 00 Opt1 elac
 000000000000000b 00 Opt2 elac</code></pre>
</li>
<li><p>然后在/etc/lirc/目录下创建lircrc配置文件或~/.lircrc<br> 格式如下 </p>
<pre><code> begin
         prog = irexec
         button = Power
         repeat = 0
         config = echo &quot;power&quot;
 end
 begin
         prog = irexec
         button = Vol+
         repeat = 1
         config = amixer -M -c 0 sset &#39;Headphone&#39;,0 1%+ &gt; /dev/null
 end
 begin
         prog = irexec
         button = Vol-
         repeat = 1
         config = amixer -M -c 0 sset &#39;Headphone&#39;,0 1%- &gt; /dev/null
 end</code></pre>
<p> 保存</p>
</li>
<li><p>最后就是使用irexec来进行各种操作了,无需编程，到这里可以自由发挥了，想要集成到代码里也很简单，看下图</p>
<pre><code> # irexec 
 lircd-0.10.1[448]: Notice: accepted new client on /var/run/lirc/lircd
 lircd-0.10.1[448]: Info: [lirc] protocol is enabled
 power
 Simple mixer control &#39;Headphone&#39;,0
 Capabilities: pvolume pvolume-joined pswitch
 Playback channels: Front Left - Front Right
 Limits: Playback 0 - 63
 Mono:
 Front Left: Playback 47 [54%] [-16.00dB] [on]
 Front Right: Playback 47 [54%] [-16.00dB] [on]
 Simple mixer control &#39;Headphone&#39;,0
 Capabilities: pvolume pvolume-joined pswitch
 Playback channels: Front Left - Front Right
 Limits: Playback 0 - 63
 Mono:
 Front Left: Playback 45 [50%] [-18.00dB] [on]
 Front Right: Playback 45 [50%] [-18.00dB] [on]
 power</code></pre>
</li>
<li><p>LIRC处理流程</p>
<pre><code>        +--------+         +-------------+                     +--------+
        |        |         | Linux input |                     | Appli- |
 ---&gt;---| kernel |----&gt;----| layer       |----------&gt;----------| cation |
        |        |         |             |  /dev/input/eventX  |        |
        +--------+         +-------------+                     +--------+

        +--------+         +-------------+
        |        |         | Linux input |
 ---&gt;---| kernel |----&gt;----| layer       |
        |        |         |             |
        +--------+         +-------------+
                                    |
                                    v
                                    |
                                    |                           +--------+
                            +-------------+                     | Appli- |
                            |    lirc     |----------&gt;----------| cation |-+
                            |             |     lirc socket     |        | |
                            +-------------+                     +--------+ |-+
                                                                    |        | |
                                                                    +--------+ |
                                                                    |        |
                                                                    +--------+

        +--------+         +-------------+                     +--------+
        |        |         |             |                     | Appli- |
 ---&gt;---| kernel |----&gt;----|    lirc     |----------&gt;----------| cation |-+
        |        |         |             |     lirc socket     |        | |
        +--------+         +-------------+                     +--------+ |-+
                                                                    |        | |
                                                                    +--------+ |
                                                                    |        |
                                                                    +--------+</code></pre>
</li>
<li><p>通过socket使用lirc,不需要引入任何文件，可以方便的集成到代码里，就是上述第三种方式</p>
<pre><code>struct sigaction act;
char buf[128];
struct sockaddr_un addr;
typedef struct
&#123;
    char addr[32];
    char code[8];
    char type[16];
    char name[16];
&#125; IRW_DATA;
IRW_DATA irw_data;
act.sa_handler = sigusr1;
sigfillset(&amp;act.sa_mask);
act.sa_flags = SA_RESTART; /* don&#39;t fiddle with EINTR */
sigaction(SIGUSR1, &amp;act, NULL);
addr.sun_family = AF_UNIX;
strcpy(addr.sun_path, &quot;/var/run/lirc/lircd&quot;);
fd_lircd = socket(AF_UNIX, SOCK_STREAM | SOCK_NONBLOCK, 0);
if (fd_lircd == -1)
&#123;
    printf(&quot;Create socket failed\n&quot;);
&#125;
if (connect(fd_lircd, (struct sockaddr *)&amp;addr, sizeof(addr)) == -1)
&#123;
    printf(&quot;Cannot connect to socket %s\n&quot;, addr.sun_path);
&#125;
while (1)
&#123;
    // lircd
    if (read(fd_lircd, buf, 128) &gt; 0)
    &#123;
        LOG_D(&quot;%s\n&quot;, buf);
        char *p = strtok(buf, &quot; &quot;);
        int i = 0;
        while (p)
        &#123;
            // LOG_D(&quot;%s\n&quot;, p);
            if (i == 0)
                strcpy(irw_data.addr, p);
            else if (i == 1)
                strcpy(irw_data.code, p);
            else if (i == 2)
                strcpy(irw_data.type, p);
            else if (i == 3)
                strcpy(irw_data.name, p);
            p = strtok(NULL, &quot; &quot;);
            i++;
        &#125;
        LOG_D(&quot;%s\n&quot;, irw_data.type);
        switch ((uint8_t)strtol(irw_data.addr, NULL, 10))
        &#123;
        case Vol_up:
            rotary_encoder_handler(&amp;u8g2, -1);
            break;
        case Vol_down:
            rotary_encoder_handler(&amp;u8g2, 1);
            break;
        case Play:
            rotary_encoder_button_handler(&amp;u8g2);
            break;
        case Bt:
            printf(&quot;BT button\n&quot;);
            break;
        &#125;
    &#125;
&#125;</code></pre>
</li>
</ol>
]]></content>
      <tags>
        <tag>V3S</tag>
        <tag>Linux</tag>
        <tag>LIRIC</tag>
        <tag>红外遥控</tag>
      </tags>
  </entry>
</search>
